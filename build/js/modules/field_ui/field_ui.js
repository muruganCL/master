!function(e){Drupal.behaviors.fieldUIFieldOverview={attach:function(t,i){e("table#field-overview",t).once("field-overview",function(){Drupal.fieldUIFieldOverview.attachUpdateSelects(this,i)})}},Drupal.fieldUIFieldOverview={attachUpdateSelects:function(t,i){var a=i.fieldWidgetTypes,r=i.fields;e(".widget-type-select",t).each(function(){this.initialValue=this.options[0].text}),e(".field-type-select",t).each(function(){this.targetSelect=e(".widget-type-select",e(this).closest("tr")),e(this).bind("change keyup",function(){var e=this.options[this.selectedIndex].value,t=e in a?a[e]:[];this.targetSelect.fieldUIPopulateOptions(t)}),e(this).trigger("change",!1)}),e(".field-select",t).each(function(){this.targetSelect=e(".widget-type-select",e(this).closest("tr")),this.targetTextfield=e(".label-textfield",e(this).closest("tr")),this.targetTextfield.data("field_ui_edited",!1).bind("keyup",function(t){e(this).data("field_ui_edited",""!=e(this).val())}),e(this).bind("change keyup",function(e,t){var t="undefined"==typeof t?!0:t,i=this.options[this.selectedIndex].value,n=i in r?r[i].type:null,l=i in r?r[i].widget:null,s=n&&n in a?a[n]:[];this.targetSelect.fieldUIPopulateOptions(s,l),t&&!this.targetTextfield.data("field_ui_edited")&&this.targetTextfield.val(i in r?r[i].label:"")}),e(this).trigger("change",!1)})}},jQuery.fn.fieldUIPopulateOptions=function(t,i){return this.each(function(){var a=!1;0==t.length&&(t=[this.initialValue],a=!0);var r=this.options[this.selectedIndex].text,n="";jQuery.each(t,function(e,t){var a="undefined"!=typeof i&&e==i||"undefined"==typeof i&&t==r;n+='<option value="'+e+'"'+(a?' selected="selected"':"")+">"+t+"</option>"}),e(this).html(n).attr("disabled",a?"disabled":!1)})},Drupal.behaviors.fieldUIDisplayOverview={attach:function(t,i){e("table#field-display-overview",t).once("field-display-overview",function(){Drupal.fieldUIOverview.attach(this,i.fieldUIRowsData,Drupal.fieldUIDisplayOverview)})}},Drupal.fieldUIOverview={attach:function(t,i,a){var r=Drupal.tableDrag[t.id];r.onDrop=this.onDrop,r.row.prototype.onSwap=this.onSwap,e("tr.draggable",t).each(function(){var t=this;if(t.id in i){var n=i[t.id];n.tableDrag=r;var l=new a[n.rowHandler](t,n);e(t).data("fieldUIRowHandler",l)}})},onChange:function(){var t=e(this),i=t.closest("tr").get(0),a=e(i).data("fieldUIRowHandler"),r={};r[a.name]=t.get(0);var n=a.getRegion();n!=a.region&&(e("select.field-parent",i).val(""),e.extend(r,a.regionChange(n)),a.region=n),Drupal.fieldUIOverview.AJAXRefreshRows(r)},onDrop:function(){var t=this,i=t.rowObject.element,a=e(i).data("fieldUIRowHandler");if("undefined"!=typeof a){var r=e(i).prevAll("tr.region-message").get(0),n=r.className.replace(/([^ ]+[ ]+)*region-([^ ]+)-message([ ]+[^ ]+)*/,"$2");n!=a.region&&(refreshRows=a.regionChange(n),a.region=n,Drupal.fieldUIOverview.AJAXRefreshRows(refreshRows))}},onSwap:function(t){var i=this;e("tr.region-message",i.table).each(function(){e(this).prev("tr").get(0)==i.group[i.group.length-1]&&("keyboard"!=i.method||"down"==i.direction)&&i.swap("after",this),e(this).next("tr").is(":not(.draggable)")||0==e(this).next("tr").length?e(this).removeClass("region-populated").addClass("region-empty"):e(this).is(".region-empty")&&e(this).removeClass("region-empty").addClass("region-populated")})},AJAXRefreshRows:function(t){var i=[],a=[];if(e.each(t,function(e,t){i.push(e),a.push(t)}),i.length){var r=e('<div class="ajax-progress ajax-progress-throbber"><div class="throbber">&nbsp;</div></div>');e(a).addClass("progress-disabled").after(r),e("input[name=refresh_rows]").val(i.join(" ")),e("input#edit-refresh").mousedown(),e(a).attr("disabled",!0)}}},Drupal.fieldUIDisplayOverview={},Drupal.fieldUIDisplayOverview.field=function(t,i){return this.row=t,this.name=i.name,this.region=i.region,this.tableDrag=i.tableDrag,this.$formatSelect=e("select.field-formatter-type",t),this.$formatSelect.change(Drupal.fieldUIOverview.onChange),this},Drupal.fieldUIDisplayOverview.field.prototype={getRegion:function(){return"hidden"==this.$formatSelect.val()?"hidden":"visible"},regionChange:function(e){var t=this.$formatSelect.val();switch(e){case"visible":if("hidden"==t)var i="undefined"!=typeof this.defaultFormatter?this.defaultFormatter:this.$formatSelect.find("option").val();break;default:var i="hidden"}void 0!=i&&this.$formatSelect.val(i);var a={};return a[this.name]=this.$formatSelect.get(0),a}}}(jQuery);