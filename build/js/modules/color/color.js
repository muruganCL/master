!function(e){Drupal.behaviors.color={attach:function(o,t){function i(){Drupal.color.callback(o,t,h,g,y,b)}function n(e,o,t){if(e=g.RGBToHSL(g.unpack(e)),e[0]+=t[0]-o[0],0==o[1]||0==t[1])e[1]=t[1];else{var i=o[1]/t[1];i>1?e[1]/=i:e[1]=1-(1-e[1])*i}if(0==o[2]||0==t[2])e[2]=t[2];else{var i=o[2]/t[2];i>1?e[2]/=i:e[2]=1-(1-e[2])*i}return g.pack(g.HSLToRGB(e))}function s(o,t,r,d){var u;if(e(o).css({backgroundColor:t,color:g.RGBToHSL(g.unpack(t))[2]>.5?"#000":"#fff"}),e(o).val()&&e(o).val()!=t){if(e(o).val(t),r){for(l=o.i,c=l+1;k[c-1]&&!e(k[c-1]).is(".unlocked");++c)u=n(t,m[o.key],m[p[c].key]),s(p[c],u,!1);for(c=l-1;k[c]&&!e(k[c]).is(".unlocked");--c)u=n(t,m[o.key],m[p[c].key]),s(p[c],u,!1);i()}d||a()}}function a(){e("#edit-scheme",h).each(function(){this.selectedIndex=this.options.length-1})}function r(){var o=this;v&&e(v).unbind("keyup",g.updateValue).unbind("keyup",i).unbind("keyup",a).parent().removeClass("item-selected"),v=this,g.linkTo(function(e){s(o,e,!0,!1)}),g.setColor(this.value),e(v).keyup(g.updateValue).keyup(i).keyup(a).parent().addClass("item-selected")}var l,c,d,u,h=e("#system-theme-settings .color-form",o).once("color");if(0!=h.length){var p=[],f=[],k=[],v=null;e(h).prepend('<div id="placeholder"></div>').addClass("color-processed");var g=e.farbtastic("#placeholder"),m=t.color.reference;for(l in m)m[l]=g.RGBToHSL(g.unpack(m[l]));var y=[],b=[];for(l in t.gradients){e("#preview").once("color").append('<div id="gradient-'+l+'"></div>');var I=e("#preview #gradient-"+l);for(y.push(parseInt(I.css("height"),10)/10),b.push(parseInt(I.css("width"),10)/10),c=0;c<("vertical"==t.gradients[l].direction?y[l]:b[l]);++c)I.append('<div class="gradient-line"></div>')}if(navigator.appVersion.match(/MSIE [0-6]\./)){var C=e("#preview #img")[0],T=C.currentStyle.backgroundImage;C.style.backgroundImage="none",C.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+T.substring(5,T.length-2)+"')"}e("#edit-scheme",h).change(function(){var o=t.color.schemes,n=this.options[this.selectedIndex].value;if(""!=n&&o[n]){d=o[n];for(u in d)s(e("#edit-palette-"+u),d[u],!1,!0);i()}}),e("#palette input.form-text",h).each(function(){this.key=this.id.substring(13),g.linkTo(function(){}).setColor("#000").linkTo(this);var o=p.length;if(p.length){var t=e('<div class="lock"></div>').toggle(function(){e(this).addClass("unlocked"),e(f[o-1]).attr("class",k[o-2]&&e(k[o-2]).is(":not(.unlocked)")?"hook up":"hook"),e(f[o]).attr("class",k[o]&&e(k[o]).is(":not(.unlocked)")?"hook down":"hook")},function(){e(this).removeClass("unlocked"),e(f[o-1]).attr("class",k[o-2]&&e(k[o-2]).is(":not(.unlocked)")?"hook both":"hook down"),e(f[o]).attr("class",k[o]&&e(k[o]).is(":not(.unlocked)")?"hook both":"hook up")});e(this).after(t),k.push(t)}var i=e('<div class="hook"></div>');e(this).after(i),f.push(i),e(this).parent().find(".lock").click(),this.i=o,p.push(this)}).focus(r),e("#palette label",h),r.call(p[0]),i()}}}}(jQuery);