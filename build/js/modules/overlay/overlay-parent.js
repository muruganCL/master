!function(e){Drupal.behaviors.overlayParent={attach:function(t,a){Drupal.overlay.isOpen&&Drupal.overlay.makeDocumentUntabbable(t),this.processed||(this.processed=!0,e(window).bind("hashchange.drupal-overlay",e.proxy(Drupal.overlay,"eventhandlerOperateByURLFragment")).triggerHandler("hashchange.drupal-overlay"),e(document).bind("click.drupal-overlay mouseup.drupal-overlay",e.proxy(Drupal.overlay,"eventhandlerOverrideLink")))}},Drupal.overlay=Drupal.overlay||{isOpen:!1,isOpening:!1,isClosing:!1,isLoading:!1},Drupal.overlay.prototype={},Drupal.overlay.open=function(t){return this.isOpen||this.isOpening?this.load(t):(this.isOpening=!0,this.originalTitle=document.title,this.create(),this.isOpening=!1,this.isOpen=!0,e(document.documentElement).addClass("overlay-open"),this.makeDocumentUntabbable(),e(document).trigger("drupalOverlayOpen"),this.load(t))},Drupal.overlay.create=function(){this.$container=e(Drupal.theme("overlayContainer")).appendTo(document.body),this.activeFrame=this.$iframeA=e(Drupal.theme("overlayElement")).appendTo(this.$container),this.inactiveFrame=this.$iframeB=e(Drupal.theme("overlayElement")).appendTo(this.$container),this.$iframeA.bind("load.drupal-overlay",{self:this.$iframeA[0],sibling:this.$iframeB},e.proxy(this,"loadChild")),this.$iframeB.bind("load.drupal-overlay",{self:this.$iframeB[0],sibling:this.$iframeA},e.proxy(this,"loadChild"));var t=".drupal-overlay.drupal-overlay-open";e(window).bind("resize"+t,e.proxy(this,"eventhandlerOuterResize")),e(document).bind("drupalOverlayLoad"+t,e.proxy(this,"eventhandlerOuterResize")).bind("drupalOverlayReady"+t+" drupalOverlayClose"+t,e.proxy(this,"eventhandlerSyncURLFragment")).bind("drupalOverlayClose"+t,e.proxy(this,"eventhandlerRefreshPage")).bind("drupalOverlayBeforeClose"+t+" drupalOverlayBeforeLoad"+t+" drupalOverlayResize"+t,e.proxy(this,"eventhandlerDispatchEvent")),e(".overlay-displace-top, .overlay-displace-bottom").length&&e(document).bind("drupalOverlayResize"+t,e.proxy(this,"eventhandlerAlterDisplacedElements")).bind("drupalOverlayClose"+t,e.proxy(this,"eventhandlerRestoreDisplacedElements"))},Drupal.overlay.load=function(t){if(!this.isOpen)return!1;e(document).trigger("drupalOverlayBeforeLoad"),e(document.documentElement).addClass("overlay-loading");var a=this.inactiveFrame[0].contentDocument||this.inactiveFrame[0].contentWindow.document;return a.location.replace(t),!0},Drupal.overlay.close=function(){if(!this.isOpen||this.isClosing)return!1;var t=e.Event("drupalOverlayBeforeClose");return e(document).trigger(t),t.isDefaultPrevented()?!1:(this.isClosing=!0,this.isOpen=!1,e(document.documentElement).removeClass("overlay-open"),document.title=this.originalTitle,this.makeDocumentTabbable(),e(document).trigger("drupalOverlayClose"),this.isLoading||(this.destroy(),this.isClosing=!1),!0)},Drupal.overlay.destroy=function(){e([document,window]).unbind(".drupal-overlay-open"),this.$container.remove(),this.$container=null,this.$iframeA=null,this.$iframeB=null,this.iframeWindow=null},Drupal.overlay.redirect=function(t){var a=e(t.link(t)).get(0);return window.location.href==a.href&&e(window).triggerHandler("hashchange.drupal-overlay"),window.location.href=a.href,!0},Drupal.overlay.bindChild=function(t,a){this.iframeWindow=t,a||this.isClosing||!this.isOpen||e(document).trigger("drupalOverlayReady")},Drupal.overlay.loadChild=function(t){var a=t.data.self,r=a.contentDocument||a.contentWindow.document,i=r.defaultView||r.parentWindow;if("about:blank"!=i.location)if(this.isLoading=!1,e(document.documentElement).removeClass("overlay-loading"),t.data.sibling.removeClass("overlay-active").attr({tabindex:-1}),this.isOpen&&!this.isClosing)if(i.Drupal&&i.Drupal.overlayChild){document.title=i.document.title,this.activeFrame=e(a).addClass("overlay-active").attr("title",Drupal.t("@title dialog",{"@title":i.jQuery("#overlay-title").text()})).removeAttr("tabindex"),this.inactiveFrame=t.data.sibling,(this.inactiveFrame[0].contentDocument||this.inactiveFrame[0].contentWindow.document).location.replace("about:blank"),this.activeFrame.focus();var n=i.jQuery("a:first");Drupal.overlay.setFocusBefore(n,i.document),e(document).trigger("drupalOverlayLoad")}else window.location=i.location.href.replace(/([?&]?)render=overlay&?/g,"$1").replace(/\?$/,"");else this.destroy()},Drupal.overlay.setFocusBefore=function(t,a){var r=a.createElement("a"),i=e(r).addClass("element-invisible").attr("href","#");i.insertBefore(t),i.focus(),i.one("blur",function(){e(this).remove()})},Drupal.overlay.isAdminLink=function(e){if(!Drupal.urlIsLocal(e))return!1;var t=this.getPath(e);if(!this.adminPathRegExp){var a="";Drupal.settings.overlay.pathPrefixes.length&&(a="("+Drupal.settings.overlay.pathPrefixes.join("/|")+"/|)");var r="^"+a+"("+Drupal.settings.overlay.paths.admin.replace(/\s+/g,"|")+")$",i="^"+a+"("+Drupal.settings.overlay.paths.non_admin.replace(/\s+/g,"|")+")$";r=r.replace(/\*/g,".*"),i=i.replace(/\*/g,".*"),this.adminPathRegExp=new RegExp(r),this.nonAdminPathRegExp=new RegExp(i)}return this.adminPathRegExp.exec(t)&&!this.nonAdminPathRegExp.exec(t)},Drupal.overlay.isExternalLink=function(e){return!Drupal.urlIsLocal(e)},Drupal.overlay.getInternalUrl=function(e){var t=Drupal.settings.basePath+e;return Drupal.urlIsLocal(t)?t:void 0},Drupal.overlay.eventhandlerOuterResize=function(t){(this.isOpen||this.isOpening)&&!this.isClosing&&this.iframeWindow&&("string"!=typeof document.body.style.maxHeight&&this.activeFrame.height(e(window).height()),e(document).trigger("drupalOverlayResize"))},Drupal.overlay.eventhandlerAlterDisplacedElements=function(t){if((this.isOpen||this.isOpening)&&!this.isClosing&&this.iframeWindow){e(this.iframeWindow.document.body).css({marginTop:Drupal.overlay.getDisplacement("top"),marginBottom:Drupal.overlay.getDisplacement("bottom")}).addClass("overlay-trigger-reflow").removeClass("overlay-trigger-reflow");var a=this.iframeWindow.document.body.clientHeight,r=this.iframeWindow.document.body.clientWidth,i="string"==typeof document.body.style.maxWidth?"maxWidth":"width";if(void 0===Drupal.overlay.leftSidedScrollbarOffset&&"rtl"===e(document.documentElement).attr("dir"))if(e.browser.opera)Drupal.overlay.leftSidedScrollbarOffset=document.documentElement.clientWidth-this.iframeWindow.document.documentElement.clientWidth+this.iframeWindow.document.documentElement.clientLeft;else if(this.iframeWindow.document.documentElement.clientLeft)Drupal.overlay.leftSidedScrollbarOffset=this.iframeWindow.document.documentElement.clientLeft;else{var n=e('<div style="direction: rtl; overflow: scroll;"></div>').appendTo(document.body),o=e("<div></div>").appendTo(n);Drupal.overlay.leftSidedScrollbarOffset=parseInt(o[0].offsetLeft-n[0].offsetLeft),n.remove()}e(".overlay-displace-top, .overlay-displace-bottom").each(function(){var t=e(this).data(),n=r;this.filters&&this.filters.length&&this.filters.item("DXImageTransform.Microsoft.Shadow")&&(n-=1),Drupal.overlay.leftSidedScrollbarOffset&&e(this).css("left",Drupal.overlay.leftSidedScrollbarOffset);var o=parseInt(e(this).css(i));(t.drupalOverlay&&t.drupalOverlay.maxWidth||isNaN(o)||o>n||0>=o)&&(e(this).css(i,n),(t.drupalOverlay=t.drupalOverlay||{}).maxWidth=!0);var l=e(this).offset(),s=l.left+e(this).outerWidth();(t.drupalOverlay&&t.drupalOverlay.clip||s>n)&&(Drupal.overlay.leftSidedScrollbarOffset?e(this).css("clip","rect(auto, auto, "+(a-l.top)+"px, "+(Drupal.overlay.leftSidedScrollbarOffset+2)+"px)"):e(this).css("clip","rect(auto, "+(n-l.left)+"px, "+(a-l.top)+"px, auto)"),(t.drupalOverlay=t.drupalOverlay||{}).clip=!0)})}},Drupal.overlay.eventhandlerRestoreDisplacedElements=function(t){var a=e(".overlay-displace-top, .overlay-displace-bottom");try{a.css({maxWidth:"",clip:""})}catch(r){a.attr("style",function(e,t){return t.replace(/clip\s*:\s*rect\([^)]+\);?/i,"")})}},Drupal.overlay.eventhandlerOverrideLink=function(t){if(!("click"==t.type&&2==t.button||"mouseup"==t.type&&2!=t.button)){var a=e(t.target);if((a.is("a")||(a=a.closest("a"),a.length))&&!a.hasClass("overlay-exclude")){if(a.hasClass("overlay-close"))return void e.bbq.removeState("overlay");var r=a[0],i=r.href;if(void 0!=i&&""!=i&&r.protocol.match(/^https?\:/)){var n=i.replace(r.ownerDocument.location.href,"");if(0==n.length||"#"==n.charAt(0))return;if(this.isAdminLink(i)){var o=a.hasClass("overlay-restore")&&"string"==typeof e.bbq.getState("overlay-context")?this.getInternalUrl(e.bbq.getState("overlay-context")):null;if(i=this.fragmentizeLink(a.get(0),o),!(0!=t.button||t.altKey||t.ctrlKey||t.metaKey||t.shiftKey))return this.redirect(i),!1;a.one("blur mousedown",{target:r,href:r.href},function(t){e(t.data.target).attr("href",t.data.href)}).attr("href",i)}else if(this.isOpen&&r.ownerDocument===this.iframeWindow.document)if(r.hostname!=window.location.hostname)a.attr("target")||a.attr("target","_parent");else{a[0].hash||a.attr("href",e.param.fragment(i,{"overlay-context":this.getPath(window.location)+window.location.search}));var l=e.deparam.querystring(i);if(l.destination&&this.isAdminLink(l.destination)){var s=e.param.fragment(this.getPath(window.location),{overlay:l.destination});a.attr("href",e.param.querystring(i,{destination:s}))}a.attr("target")||a.attr("target","_parent")}}}}},Drupal.overlay.eventhandlerOperateByURLFragment=function(t){if("redirect"===e.data(window.location,window.location.href))return void e.data(window.location,window.location.href,null);var a=null,r=e.bbq.getState("overlay");if(r&&(a=this.getInternalUrl(r)),a){var i=e.param.querystring(a,{render:"overlay"});this.open(i),this.resetActiveClass(this.getPath(Drupal.settings.basePath+r))}else this.isOpen&&!this.isClosing&&(this.close(),this.resetActiveClass(this.getPath(window.location)))},Drupal.overlay.eventhandlerSyncURLFragment=function(t){if(this.isOpen){var a=e.bbq.getState("overlay");if(this.getPath(Drupal.settings.basePath+a)!=this.getPath(this.iframeWindow.document.location)){var r=Drupal.overlay.fragmentizeLink(this.iframeWindow.document.location);e.data(window.location,r,"redirect"),window.location.replace(r)}}else e.bbq.removeState("overlay")},Drupal.overlay.eventhandlerRefreshPage=function(e){Drupal.overlay.refreshPage&&window.location.reload(!0)},Drupal.overlay.eventhandlerDispatchEvent=function(e){this.iframeWindow&&this.iframeWindow.document&&this.iframeWindow.jQuery(this.iframeWindow.document).trigger(e)},Drupal.overlay.fragmentizeLink=function(t,a){var r=e.deparam.fragment(t.href);if(r.overlay)return t.href;var i=this.getPath(t,!0),n=i+t.search.replace(/&?render=overlay/,"").replace(/\?$/,"")+t.hash;return e.param.fragment(a||window.location.href,{overlay:n})},Drupal.overlay.refreshRegions=function(t){e.each(t,function(){var t=this;e.each(t,function(a){var r=t[a],i="."+a;Drupal.detachBehaviors(e(i)),e.get(Drupal.settings.basePath+Drupal.settings.overlay.ajaxCallback+"/"+r,function(t){e(i).replaceWith(e(t)),Drupal.attachBehaviors(e(i),Drupal.settings)})})})},Drupal.overlay.resetActiveClass=function(t){var a=this,r=window.location.protocol+window.location.hostname;e(".overlay-displace-top, .overlay-displace-bottom").find("a[href]").removeClass("active").each(function(){var i=this.protocol+this.hostname,n=a.getPath(this);i!=r||0!==(t+"/").indexOf(n+"/")||""===n&&""!==t||e(this).addClass("active")})},Drupal.overlay.getPath=function(t,a){"string"==typeof t&&(t=e(t.link(t)).get(0));var r=t.pathname;if("/"!=r.charAt(0)&&(r="/"+r),r=r.replace(new RegExp(Drupal.settings.basePath+"(?:index.php)?"),""),""==r&&!a){var i=new RegExp("([?&])q=(.+)([&#]|$)").exec(t.search);i&&4==i.length&&(r=i[2])}return r},Drupal.overlay.getDisplacement=function(t){var a=0,r=e(".overlay-displace-"+t+":last");if(r.length){a=r.offset().top+r.outerHeight();var i=r.css("box-shadow"),n="undefined"!=typeof i&&"none"!==i;!n&&/DXImageTransform\.Microsoft\.Shadow/.test(r.css("filter"))&&(a-=r[0].filters.item("DXImageTransform.Microsoft.Shadow").strength,a=Math.max(0,a))}return a},Drupal.overlay.makeDocumentUntabbable=function(t){if(jQuery.browser.msie&&parseInt(jQuery.browser.version,10)<8)return void e("#overlay-disable-message a",t).attr("tabindex",-1);t=t||document.body;var a,r,i;i=e("[tabindex] :not(.overlay-element)",t),i.each(Drupal.overlay._recordTabindex),Drupal.overlay._hasTabindex=i.add(Drupal.overlay._hasTabindex),r=e("a, area, button, input, object, select, textarea, iframe"),r=r.add(i),a=e(".overlay-element, #overlay-container, .overlay-displace-top, .overlay-displace-bottom").find("*"),r=r.not(a),r.attr("tabindex",-1)},Drupal.overlay.makeDocumentTabbable=function(t){if(!(jQuery.browser.msie&&parseInt(jQuery.browser.version,10)<8)){var a;t=t||document.body;var r=e("[tabindex]",t);if(jQuery.browser.msie&&parseInt(jQuery.browser.version,10)<8){var i,n=r.length;for(i=0;n>i;i++)r[i].removeAttribute("tabIndex")}else r.removeAttr("tabindex");a=e(Drupal.overlay._hasTabindex,t),a.each(Drupal.overlay._restoreTabindex),Drupal.overlay._hasTabindex=Drupal.overlay._hasTabindex.not(a)}},Drupal.overlay._recordTabindex=function(){var t=e(this),a=e(this).attr("tabindex");t.data("drupalOverlayOriginalTabIndex",a)},Drupal.overlay._restoreTabindex=function(){var t=e(this),a=t.data("drupalOverlayOriginalTabIndex");t.attr("tabindex",a)},Drupal.theme.prototype.overlayContainer=function(){return'<div id="overlay-container"><div class="overlay-modal-background"></div></div>'},Drupal.theme.prototype.overlayElement=function(e){return'<iframe class="overlay-element" frameborder="0" scrolling="auto" allowtransparency="true"></iframe>'}}(jQuery);