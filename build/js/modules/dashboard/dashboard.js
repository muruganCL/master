!function(a){Drupal.behaviors.dashboard={attach:function(s,e){a("#dashboard",s).once(function(){a(this).prepend('<div class="customize clearfix"><ul class="action-links"><li><a href="#">'+Drupal.t("Customize dashboard")+'</a></li></ul><div class="canvas"></div></div>'),a(".customize .action-links a",this).click(Drupal.behaviors.dashboard.enterCustomizeMode)}),Drupal.behaviors.dashboard.addPlaceholders(),Drupal.settings.dashboard.launchCustomize&&Drupal.behaviors.dashboard.enterCustomizeMode()},addPlaceholders:function(){a("#dashboard .dashboard-region .region").each(function(){var s="";0==a(".block",this).length?(s=a("#dashboard").hasClass("customize-mode")?Drupal.settings.dashboard.emptyRegionTextActive:Drupal.settings.dashboard.emptyRegionTextInactive,0==a(".dashboard-placeholder",this).length&&a(this).append('<div class="dashboard-placeholder"></div>'),a(".dashboard-placeholder",this).html(s)):a(".dashboard-placeholder",this).remove()})},enterCustomizeMode:function(){a("#dashboard").addClass("customize-mode customize-inactive"),Drupal.behaviors.dashboard.addPlaceholders(),a("#dashboard .customize .action-links").hide(),a("div.customize .canvas").load(Drupal.settings.dashboard.drawer,Drupal.behaviors.dashboard.setupDrawer)},exitCustomizeMode:function(){a("#dashboard").removeClass("customize-mode customize-inactive"),Drupal.behaviors.dashboard.addPlaceholders(),location.href=Drupal.settings.dashboard.dashboard},setupDrawer:function(){a("div.customize .canvas-content input").click(Drupal.behaviors.dashboard.exitCustomizeMode),a("div.customize .canvas-content").append('<a class="button" href="'+Drupal.settings.dashboard.dashboard+'">'+Drupal.t("Done")+"</a>");var s=a("#dashboard div.region");s.sortable({connectWith:s,cursor:"move",cursorAt:{top:0},dropOnEmpty:!0,items:"> div.block, > div.disabled-block",placeholder:"block-placeholder clearfix",tolerance:"pointer",start:Drupal.behaviors.dashboard.start,over:Drupal.behaviors.dashboard.over,sort:Drupal.behaviors.dashboard.sort,update:Drupal.behaviors.dashboard.update})},start:function(s,e){a("#dashboard").removeClass("customize-inactive");var o=a(e.item);o.hasClass("disabled-block")||o.css({height:"auto"})},over:function(s,e){var o=a(e.item);a(this).closest("#disabled-blocks").length?o.css("width",""):o.css("width",a(this).width())},sort:function(s,e){var o=a(e.item);s.pageX>e.offset.left+o.width()&&o.css("left",s.pageX)},update:function(s,e){a("#dashboard").addClass("customize-inactive");var o=a(e.item);if(o.hasClass("disabled-block")){var t,d,r;r=o.attr("class"),t=r.match(/\bmodule-(\S+)\b/)[1],d=r.match(/\bdelta-(\S+)\b/)[1],a.get(Drupal.settings.dashboard.blockContent+"/"+t+"/"+d,{},function(a){a&&o.html(a),o.find("div.content").is(":empty")&&o.find("div.content").html(Drupal.settings.dashboard.emptyBlockText),Drupal.attachBehaviors(o)},"html"),o.removeClass("disabled-block")}Drupal.behaviors.dashboard.addPlaceholders(),a.post(Drupal.settings.dashboard.updatePath,{form_token:Drupal.settings.dashboard.formToken,regions:Drupal.behaviors.dashboard.getOrder})},getOrder:function(){var s=[];return a("#dashboard div.region").each(function(){var e=a(this).parent().attr("id").replace(/-/g,"_"),o=a(this).sortable("toArray");a.each(o,function(){s.push(e+"[]="+this)})}),s=s.join("&")}}}(jQuery);