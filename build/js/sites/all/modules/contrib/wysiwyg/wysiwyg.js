!function(e){function t(e,t){if(!o[e]){var a=-1===e.indexOf("--")?e:e.substr(0,e.indexOf("--"));if(!o[a]){if("undefined"==typeof t)throw new Error('Wysiwyg module has no information about field "'+e+'"');o[a]=t}return o[a]}return o[e]}function a(e,t){if(!l[e]){if("undefined"==typeof t)return{editor:"none"};l[e]=t}return l[e]}function i(e,t,a){var i=t.status?t.editor:"none";Drupal.wysiwyg.instances[t.field]={},jQuery.extend(!0,Drupal.wysiwyg.instances[t.field],t),"object"==typeof Drupal.wysiwyg.editor.instance[i]&&jQuery.extend(!0,Drupal.wysiwyg.instances[t.field],Drupal.wysiwyg.editor.instance[i]),"function"==typeof Drupal.wysiwyg.editor.attach[i]&&Drupal.wysiwyg.editor.attach[i](e,t,t.status?jQuery.extend(!0,{},a):{})}function r(e,t,a){var i=t.status?t.editor:"none";jQuery.isFunction(Drupal.wysiwyg.editor.detach[i])&&Drupal.wysiwyg.editor.detach[i](e,t,a),"unload"==a&&delete Drupal.wysiwyg.instances[t.field]}function s(e){var t=null;if("object"!=typeof e)return e;if(t=new e.constructor,e.drupalWysiwygType)switch(e.drupalWysiwygType){case"callback":t=n(e.name,e.context);break;case"regexp":t=new RegExp(e.regexp,e.modifiers?e.modifiers:void 0);break;default:t.drupalWysiwygType=e.drupalWysiwygType}else for(var a in e)e.hasOwnProperty(a)&&e[a]&&"object"==typeof e[a]?t[a]=s(e[a]):t[a]=e[a];return t}function n(e,t){for(var a=e.split("."),i=a.pop(),r=window,s=0;r&&s<a.length;s++)r=r[a[s]];if(!r)throw"Wysiwyg: Unable to locate callback "+a.join(".")+"."+i+"()";if(t){if("string"==typeof t){for(a=t.split("."),t=window,s=0;t&&s<a.length;s++)t=t[a[s]];if(!t)throw"Wysiwyg: Unable to locate context object "+a.join(".")}}else t=r;if("function"!=typeof r[i])throw"Wysiwyg: "+i+" is not a callback function";return function(){return r[i].apply(t,arguments)}}var o=Drupal.wysiwyg._fieldInfoStorage=Drupal.wysiwyg._fieldInfoStorage||{},l=l=Drupal.wysiwyg._formatInfoStorage||{};Drupal.wysiwygInit=function(){/KDE/.test(navigator.vendor)||jQuery.each(Drupal.wysiwyg.editor.init,function(e){this(jQuery.extend(!0,{},Drupal.settings.wysiwyg.configs[e]))})},Drupal.behaviors.attachWysiwyg={attach:function(i,r){/KDE/.test(navigator.vendor)||e(".wysiwyg:input",i).once("wysiwyg",function(){var n=e("#"+this.id,document),o=r.wysiwyg.triggers[this.id];if(o&&n.length){var l;o.select&&(l=e("#"+o.select+":input",i));var y=t(o.field,{activeFormat:"format"+(l?l.val():o.activeFormat),formats:{},resizable:o.resizable,getFormatInfo:function(){return a(this.activeFormat)}});o.select&&(y.select=o.select),y.summary=o.summary;for(var u in o)if(0==u.indexOf("format")){y.formats[u]||(y.formats[u]={enabled:o[u].status},o[u].skip_summary&&(y.formats[u].skip_summary=!0));var w=a(u,null);if(!w){var d={};r.wysiwyg.configs[o[u].editor]&&(d=r.wysiwyg.configs[o[u].editor][u]),w=a(u,{editor:o[u].editor,toggle:o[u].toggle,editorSettings:s(d)})}}y.enabled=y.formats[y.activeFormat]&&y.formats[y.activeFormat].enabled,Drupal.wysiwygAttach(i,o.field),l&&l.is("select")&&l.change(function(e,a){return function(i){var r=t(a);r.formats[r.activeFormat]&&(r.formats[r.activeFormat].enabled=r.enabled),r.activeFormat="format"+this.value,r.formats[r.activeFormat]?r.enabled=r.formats[r.activeFormat].enabled:r.enabled=!1,Drupal.wysiwygAttach(e,a)}}(i,o.field)),n.closest("form").submit(function(e,t){return function(a){a.isDefaultPrevented()||Drupal.wysiwygDetach(e,t,"serialize")}}(i,o.field))}})},detach:function(t,a,i){var r;r="serialize"==i?e(".wysiwyg-processed:input",t):e(".wysiwyg:input",t).removeOnce("wysiwyg"),r.each(function(){Drupal.wysiwygDetach(t,this.id,i)})}},Drupal.wysiwygAttach=function(a,s){var n=t(s),o=n.getFormatInfo(),l=o.editor,y=status,u="none",w=n.summary&&(!n.formats[n.activeFormat]||!n.formats[n.activeFormat].skip_summary);Drupal.wysiwyg.instances[s]&&(y=Drupal.wysiwyg.instances[s].status,u=Drupal.wysiwyg.instances[s].editor),r(a,{editor:u,status:y,field:s,resizable:n.resizable},"unload"),w&&(Drupal.wysiwyg.instances[n.summary]&&(y=Drupal.wysiwyg.instances[n.summary].status),r(a,{editor:u,status:y,field:n.summary,resizable:n.resizable},"unload")),Drupal.wysiwyg.activeId=s,Drupal.wysiwygAttachToggleLink(a,s);var d=jQuery.extend(!0,{},o.editorSettings);i(a,{status:n.enabled,editor:l,field:s,format:n.activeFormat,resizable:n.resizable},d),w&&(e("#"+n.summary).parents(".text-summary-wrapper").is(":visible")?i(a,{status:n.enabled,editor:l,field:n.summary,format:n.activeFormat,resizable:n.resizable},d):(i(a,{status:!1,editor:l,field:n.summary,format:n.activeFormat,resizable:n.resizable},d),e("#"+s).parents(".text-format-wrapper").find(".link-edit-summary").unbind("click.wysiwyg").bind("click.wysiwyg",function(){r(a,{status:!1,editor:l,field:n.summary,format:n.activeFormat,resizable:n.resizable},d),i(a,{status:n.enabled,editor:l,field:n.summary,format:n.activeFormat,resizable:n.resizable},d),e(this).unbind("click.wysiwyg")})))},Drupal.wysiwygDetach=function(a,s,n){var o=t(s),l=o.getFormatInfo().editor,n=n||"unload",y=Drupal.wysiwyg.instances[s]&&Drupal.wysiwyg.instances[s].status;r(a,{editor:l,status:y,field:s,resizable:o.resizable},n),"unload"==n&&(i(a,{editor:l,status:!1,format:o.activeFormat,field:s,resizable:o.resizable}),Drupal.wysiwygAttachToggleLink(a,s)),o.summary&&Drupal.wysiwyg.instances[o.summary]&&(e("#"+s).parents(".text-format-wrapper").find(".link-edit-summary").unbind("click.wysiwyg"),Drupal.wysiwyg.instances[o.summary]&&(y=Drupal.wysiwyg.instances[o.summary].status),r(a,{editor:l,status:y,field:o.summary,resizable:o.resizable},n),"unload"==n&&i(a,{editor:l,status:!1,format:o.activeFormat,field:o.summary,resizable:o.resizable}))},Drupal.wysiwygAttachToggleLink=function(a,i){var r=t(i),s=r.getFormatInfo().editor;if(!r.getFormatInfo().toggle)return void e("#wysiwyg-toggle-"+i).hide();if(!e("#wysiwyg-toggle-"+i,a).length){var n=document.createTextNode(r.enabled?Drupal.settings.wysiwyg.disable:Drupal.settings.wysiwyg.enable),o=document.createElement("a"),l=document.createElement("div");e(o).attr({id:"wysiwyg-toggle-"+i,href:"javascript:void(0);"}).append(n),e(l).addClass("wysiwyg-toggle-wrapper").append(o),0==e("#"+r.select).closest(".fieldset-wrapper").prepend(l).length&&e("#"+i).after(l)}e("#wysiwyg-toggle-"+i,a).html(r.enabled?Drupal.settings.wysiwyg.disable:Drupal.settings.wysiwyg.enable).show().unbind("click.wysiwyg").bind("click.wysiwyg",{fieldId:i,context:a},Drupal.wysiwyg.toggleWysiwyg),"none"==s&&e("#wysiwyg-toggle-"+i).hide()},Drupal.wysiwyg.toggleWysiwyg=function(e){var a=e.data.context,i=e.data.fieldId,r=t(i);r.enabled?(r.enabled=!1,Drupal.wysiwygDetach(a,i,"unload")):(r.enabled=!0,Drupal.wysiwygAttach(a,i)),r.formats[r.activeFormat].enabled=r.enabled};var y=Drupal.ajax?Drupal.ajax.prototype.beforeSerialize:!1;y&&(Drupal.ajax.prototype.beforeSerialize=function(t,a){var i=y.call(this,t,a),r=[];return e.each(Drupal.wysiwyg.excludeIdSelectors,function(){e.isArray(this)&&(r=r.concat(this))}),r.length>0&&(a.data["ajax_html_ids[]"]=[],e("[id]:not("+r.join(",")+")").each(function(){a.data["ajax_html_ids[]"].push(this.id)})),i}),Drupal.wysiwygInit(),e(document).unbind("CToolsDetachBehaviors.wysiwyg").bind("CToolsDetachBehaviors.wysiwyg",function(e,t){Drupal.behaviors.attachWysiwyg.detach(t,{},"unload")})}(jQuery);