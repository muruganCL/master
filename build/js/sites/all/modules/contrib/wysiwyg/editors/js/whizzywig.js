var wysiwygWhizzywig={currentField:null,fields:{}},buttonPath=null,w=function(i){return i&&(wysiwygWhizzywig.fields[wysiwygWhizzywig.currentField]+=i),wysiwygWhizzywig.fields[wysiwygWhizzywig.currentField]},o=function(i){return i=="whizzy"+wysiwygWhizzywig.currentField&&wysiwygWhizzywig.fields[wysiwygWhizzywig.currentField]&&(jQuery("#"+wysiwygWhizzywig.currentField).after('<div id="'+wysiwygWhizzywig.currentField+'-whizzywig"></div>'),jQuery("#"+wysiwygWhizzywig.currentField+"-whizzywig").html(w()),wysiwygWhizzywig.fields[wysiwygWhizzywig.currentField]=""),jQuery("#"+i).size()?jQuery("#"+i).get(0):jQuery("#"+i,w()).get(0)};!function(i){Drupal.wysiwyg.editor.attach.whizzywig=function(e,t,w){w.buttonPath&&(window.buttonPath=w.buttonPath),wysiwygWhizzywig.currentField=t.field,wysiwygWhizzywig.fields[wysiwygWhizzywig.currentField]="";var y=i("#"+t.field),n=Drupal.wysiwyg.instances[t.field];n.originalStyle=y.attr("style"),y.css("width",y.width()+"px"),makeWhizzyWig(t.field,w.buttons?w.buttons:"all"),i("#whizzy"+t.field).contents().find("body").html(tidyD(y.val()))},Drupal.wysiwyg.editor.detach.whizzywig=function(e,t,w){var y=function(e){var t=whizzies[e],y=i("#"+t),n=Drupal.wysiwyg.instances[t];y.val(n.getContent()),"serialize"!=w&&(i("#"+t+"-whizzywig").remove(),whizzies.splice(e,1),y.removeAttr("style").attr("style",n.originalStyle))};if("undefined"!=typeof t){for(var n=0;n<whizzies.length;n++)if(whizzies[n]==t.field){y(n);break}}else for(;whizzies.length>0;)y(0)},Drupal.wysiwyg.editor.instance.whizzywig={insert:function(i){insHTML(i.replace(/^js:/,"js&colon;"))},setContent:function(e){var t=i("#"+this.field);if("block"==t.css("display"))t.val(e);else{var w=i("#whizzy"+this.field).contents()[0];w.open(),w.write(e),w.close()}},getContent:function(){var e=i("#"+this.field),t="block"==e.css("display")?e.val():i("#whizzy"+this.field).contents().find("body").html();if(t=tidyH(t),i.isFunction(window.get_xhtml)){var w=document.createElement("pre");w.innerHTML=t,t=get_xhtml(w)}return t.replace(location.href+"#","#")}}}(jQuery);