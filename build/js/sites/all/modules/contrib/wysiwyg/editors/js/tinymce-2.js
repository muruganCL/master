!function(t){Drupal.wysiwyg.editor.init.tinymce=function(t){for(var n in t)if(tinyMCE.init(t[n]),Drupal.settings.wysiwyg.plugins[n]){for(var i in Drupal.settings.wysiwyg.plugins[n]["native"])tinyMCE.loadPlugin(i,Drupal.settings.wysiwyg.plugins[n]["native"][i]);for(var i in Drupal.settings.wysiwyg.plugins[n].drupal)Drupal.wysiwyg.editor.instance.tinymce.addPlugin(i,Drupal.settings.wysiwyg.plugins[n].drupal[i],Drupal.settings.wysiwyg.plugins.drupal[i])}},Drupal.wysiwyg.editor.attach.tinymce=function(n,i,e){for(var s in e)tinyMCE.settings[s]=e[s];var r=t("#"+i.field);r.val(r.val().replace(/(<.+?\s+class=['"][\w\s]*?)\bmceItem\b([\w\s]*?['"].*?>)/gi,"$1$2")),tinyMCE.execCommand("mceAddControl",!0,i.field)},Drupal.wysiwyg.editor.detach.tinymce=function(n,i,e){"undefined"!=typeof i&&(tinyMCE.removeMCEControl(tinyMCE.getEditorId(i.field)),t("#"+i.field).removeAttr("style"))},Drupal.wysiwyg.editor.instance.tinymce={addPlugin:function(t,n,i){"object"==typeof Drupal.wysiwyg.plugins[t]&&tinyMCE.addPlugin(t,{execCommand:function(n,e,s,r,a){switch(s){case t:if("function"==typeof Drupal.wysiwyg.plugins[t].invoke){var o=tinyMCE.getInstanceById(n),l={format:"html",node:o.getFocusElement(),content:o.getFocusElement()};return Drupal.wysiwyg.plugins[t].invoke(l,i,o.formTargetElementId),!0}}return!1},getControlHTML:function(i){switch(i){case t:return tinyMCE.getButtonHTML(i,n.iconTitle,n.icon,t)}return""},initInstance:function(t){n.css&&tinyMCE.importCSS(t.getDoc(),n.css)},cleanup:function(n,e){switch(n){case"insert_to_editor":"function"==typeof Drupal.wysiwyg.plugins[t].attach&&(e=Drupal.wysiwyg.plugins[t].attach(e,i,tinyMCE.selectedInstance.editorId),e=Drupal.wysiwyg.editor.instance.tinymce.prepareContent(e));break;case"get_from_editor":"function"==typeof Drupal.wysiwyg.plugins[t].detach&&(e=Drupal.wysiwyg.plugins[t].detach(e,i,tinyMCE.selectedInstance.editorId))}return e},handleNodeChange:function(n,i,e,s,r,a){return null!==i?"function"==typeof Drupal.wysiwyg.plugins[t].isNode&&Drupal.wysiwyg.plugins[t].isNode(i)?(tinyMCE.switchClass(n+"_"+t,"mceButtonSelected"),!0):(tinyMCE.switchClass(n+"_"+t,"mceButtonNormal"),!0):void 0},getInfo:function(){return{longname:n.title}}})},openDialog:function(t,n){tinyMCE.getInstanceById(this.field);tinyMCE.openWindow({file:t.url+"/"+this.field,width:t.width,height:t.height,inline:1},n)},closeDialog:function(t){tinyMCE.getInstanceById(this.field);tinyMCEPopup.close()},prepareContent:function(n){var i={img:{name:"mce_drupal"}},e=t("<div>"+n+"</div>");return jQuery.each(i,function(n,i){e.find(n).each(function(){for(var n in i)"class"==n?t(this).addClass(i[n]):t(this).attr(n,i[n])})}),e.html()},insert:function(t){t=this.prepareContent(t);var n=tinyMCE.getInstanceById(this.field);n.execCommand("mceInsertContent",!1,t),n.repaint()}}}(jQuery);