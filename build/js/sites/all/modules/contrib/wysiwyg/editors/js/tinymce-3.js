!function(n){Drupal.wysiwyg.editor.init.tinymce=function(e){var t=n("#toolbar, #admin-menu",Drupal.overlayChild?window.parent.document:document);tinyMCE.onAddEditor.add(function(n,e){"mce_fullscreen"==e.id&&t.hide()}),tinyMCE.onRemoveEditor.add(function(n,e){"mce_fullscreen"==e.id&&t.show()});for(var i in e)if(Drupal.settings.wysiwyg.plugins[i]){for(var o in Drupal.settings.wysiwyg.plugins[i]["native"])tinymce.PluginManager.load(o,Drupal.settings.wysiwyg.plugins[i]["native"][o]);for(var o in Drupal.settings.wysiwyg.plugins[i].drupal)Drupal.wysiwyg.editor.instance.tinymce.addPlugin(o,Drupal.settings.wysiwyg.plugins[i].drupal[o],Drupal.settings.wysiwyg.plugins.drupal[o])}},Drupal.wysiwyg.editor.attach.tinymce=function(e,t,i){var o=new tinymce.Editor(t.field,i);o.onEvent.add(function(n,e){Drupal.wysiwyg.activeId=n.id}),tinymce.dom.Event.domLoaded=!0,o.onPostRender.add(function(e){var t=n('<div class="wysiwygToolbar"></div>');n("#"+e.editorContainer+" table.mceToolbar > tbody > tr > td").each(function(){n("<div></div>").addClass(this.className).append(n(this).children()).appendTo(t)}),n("#"+e.editorContainer+" table.mceLayout td.mceToolbar").append(t),n("#"+e.editorContainer+" table.mceToolbar").remove()});var a=n("#"+t.field);a.val(a.val().replace(/(<.+?\s+class=['"][\w\s]*?)\bmceItem\b([\w\s]*?['"].*?>)/gi,"$1$2")),o.render(),"5.7"==tinymce.minorVersion&&setTimeout(function(){tinymce.DOM.show(o.editorContainer)},1)},Drupal.wysiwyg.editor.detach.tinymce=function(n,e,t){if("undefined"!=typeof e){var i=tinyMCE.get(e.field);i&&(i.save(),"serialize"!=t&&i.remove())}else if(tinyMCE.triggerSave(),"serialize"!=t)for(var i in tinyMCE.editors)tinyMCE.editors[i].remove()},Drupal.wysiwyg.editor.instance.tinymce={addPlugin:function(n,e,t){"object"==typeof Drupal.wysiwyg.plugins[n]&&(tinymce.create("tinymce.plugins."+n,{init:function(i,o){i.addCommand(n,function(){if("function"==typeof Drupal.wysiwyg.plugins[n].invoke){var e={format:"html",node:i.selection.getNode(),content:i.selection.getContent()},o="mce_fullscreen"==i.id?i.getParam("fullscreen_editor_id"):i.id;Drupal.wysiwyg.plugins[n].invoke(e,t,o)}}),i.addButton(n,{title:e.iconTitle,cmd:n,image:e.icon}),i.onInit.add(function(){e.css&&i.dom.loadCSS(e.css)}),i.onBeforeSetContent.add(function(e,i){var o="mce_fullscreen"==e.id?e.getParam("fullscreen_editor_id"):e.id;"function"==typeof Drupal.wysiwyg.plugins[n].attach&&(i.content=Drupal.wysiwyg.plugins[n].attach(i.content,t,o),i.content=Drupal.wysiwyg.editor.instance.tinymce.prepareContent(i.content))}),i.onGetContent.add(function(e,i){var o="mce_fullscreen"==e.id?e.getParam("fullscreen_editor_id"):e.id;"function"==typeof Drupal.wysiwyg.plugins[n].detach&&(i.content=Drupal.wysiwyg.plugins[n].detach(i.content,t,o))}),i.onNodeChange.add(function(e,t,i){"function"==typeof Drupal.wysiwyg.plugins[n].isNode&&t.setActive(n,Drupal.wysiwyg.plugins[n].isNode(i))})},getInfo:function(){return{longname:e.title}}}),tinymce.PluginManager.add(n,tinymce.plugins[n]))},openDialog:function(n,e){var t=this.getInstanceId(),i=tinyMCE.get(t);i.windowManager.open({file:n.url+"/"+t,width:n.width,height:n.height,inline:1},e)},closeDialog:function(n){var e=tinyMCE.get(this.getInstanceId());e.windowManager.close(n)},prepareContent:function(e){var t={img:{"class":"mceItem"}},i=n("<div>"+e+"</div>");return i.find(".drupal-content").each(function(){var e=n(this);n.each(t,function(t,i){e.find(t).andSelf().each(function(){for(var e in i)"class"==e?n(this).addClass(i[e]):n(this).attr(e,i[e])})})}),i.html()},insert:function(n){n=this.prepareContent(n),tinyMCE.execInstanceCommand(this.getInstanceId(),"mceInsertContent",!1,n)},setContent:function(n){n=this.prepareContent(n),tinyMCE.execInstanceCommand(this.getInstanceId(),"mceSetContent",!1,n)},getContent:function(){return tinyMCE.get(this.getInstanceId()).getContent()},isFullscreen:function(){return"mce_fullscreen"==tinyMCE.activeEditor.id&&tinyMCE.activeEditor.getParam("fullscreen_editor_id")==this.field},getInstanceId:function(){return this.isFullscreen()?"mce_fullscreen":this.field}}}(jQuery);