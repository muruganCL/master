!function(e){function n(n,t){var i=!1;return n===t?!0:(e(n).parents().each(function(e,n){return n===t?(i=!0,!1):void 0}),i)}Drupal.wysiwyg.editor.attach.nicedit=function(e,n,t){var i=bkLib.addEvent;bkLib.addEvent=function(e,n,t){"submit"!=n&&i(e,n,t)};var r=new nicEditor(t);r.panelInstance(n.field),bkLib.addEvent=i,r.addEvent("focus",function(){Drupal.wysiwyg.activeId=n.field})},Drupal.wysiwyg.editor.detach.nicedit=function(e,n,t){if("undefined"!=typeof n){var i=nicEditors.findEditor(n.field);i&&("serialize"==t?i.saveContent():(i.ne.removeInstance(n.field),i.ne.removePanel()))}else for(var r in nicEditors.editors){for(var o=nicEditors.editors[r].nicInstances,d=0;d<o.length;d++)"serialize"==t?o[d].saveContent():o[d].remove();"serialize"!=t&&(nicEditors.editors[r].nicInstances=[])}},Drupal.wysiwyg.editor.instance.nicedit={insert:function(e){var t,i=nicEditors.findEditor(this.field),r=i.getElm(),o=i.getSel();if(document.selection)t=o.createRange(),n(t.parentElement(),r)?(t.pasteHTML(e),t.select(),t.collapse(!1)):r.innerHTML+=e;else{if(o.getRangeAt?o.rangeCount>0&&(t=o.getRangeAt(0)):(t=r.ownerDocument.createRange(),t.setStart(o.anchorNode,o.anchorOffset),t.setEnd(o.focusNode,userSeletion.focusOffset)),0==o.rangeCount||!n(t.commonAncestorContainer,r))return void(r.innerHTML+=e);var d=r.ownerDocument.createDocumentFragment(),a=r.ownerDocument.createElement("div");for(a.innerHTML=e;a.firstChild;)d.appendChild(a.firstChild);var s=r.ownerDocument.createElement("span");d.appendChild(s),t.deleteContents(),t.insertNode(d),t.setStartBefore(s),t.setEndBefore(s),o.removeAllRanges(),o.addRange(t),s.parentNode.removeChild(s)}},setContent:function(e){nicEditors.findEditor(this.field).setContent(e)},getContent:function(){return nicEditors.findEditor(this.field).getContent()}}}(jQuery);