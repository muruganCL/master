!function(e){function t(){this._disabledInputs=[],this.regional=[],this.regional[""]={show24Hours:!1,separator:":",ampmPrefix:"",ampmNames:["AM","PM"],spinnerTexts:["Now","Previous field","Next field","Increment","Decrement"]},this._defaults={appendText:"",showSeconds:!1,timeSteps:[1,1,1],initialField:0,noSeparatorEntry:!1,useMouseWheel:!0,defaultTime:null,minTime:null,maxTime:null,spinnerImage:"spinnerDefault.png",spinnerSize:[20,20,8],spinnerBigImage:"",spinnerBigSize:[40,40,16],spinnerIncDecOnly:!1,spinnerRepeat:[500,250],beforeShow:null,beforeSetTime:null},e.extend(this._defaults,this.regional[""])}function n(t,n){return"option"==t&&(0==n.length||1==n.length&&"string"==typeof n[0])?!0:e.inArray(t,i)>-1}e.extend(t.prototype,{markerClassName:"hasTimeEntry",propertyName:"timeEntry",_appendClass:"timeEntry_append",_controlClass:"timeEntry_control",_expandClass:"timeEntry_expand",setDefaults:function(t){return e.extend(this._defaults,t||{}),this},_attachPlugin:function(t,n){var i=e(t);if(!i.hasClass(this.markerClassName)){var a={options:e.extend({},this._defaults,n),input:i,_field:0,_selectedHour:0,_selectedMinute:0,_selectedSecond:0};i.data(this.propertyName,a).addClass(this.markerClassName).bind("focus."+this.propertyName,this._doFocus).bind("blur."+this.propertyName,this._doBlur).bind("click."+this.propertyName,this._doClick).bind("keydown."+this.propertyName,this._doKeyDown).bind("keypress."+this.propertyName,this._doKeyPress).bind("paste."+this.propertyName,function(e){setTimeout(function(){s._parseTime(a)},1)}),this._optionPlugin(t,n)}},_optionPlugin:function(t,n,i){t=e(t);var s=t.data(this.propertyName);if(!n||"string"==typeof n&&null==i){var a=n;return n=(s||{}).options,n&&a?n[a]:n}if(t.hasClass(this.markerClassName)){if(n=n||{},"string"==typeof n){var a=n;n={},n[a]=i}var o=this._extractTime(s);e.extend(s.options,n),s._field=0,o&&this._setTime(s,new Date(0,0,0,o[0],o[1],o[2])),t.next("span."+this._appendClass).remove(),t.parent().find("span."+this._controlClass).remove(),e.fn.mousewheel&&t.unmousewheel();var r=s.options.spinnerImage?e('<span class="'+this._controlClass+'" style="display: inline-block; background: url(\''+s.options.spinnerImage+"') 0 0 no-repeat; width: "+s.options.spinnerSize[0]+"px; height: "+s.options.spinnerSize[1]+'px;"></span>'):null;t.after(s.options.appendText?'<span class="'+this._appendClass+'">'+s.options.appendText+"</span>":"").after(r||""),s.options.useMouseWheel&&e.fn.mousewheel&&t.mousewheel(this._doMouseWheel),r&&r.mousedown(this._handleSpinner).mouseup(this._endSpinner).mouseover(this._expandSpinner).mouseout(this._endSpinner).mousemove(this._describeSpinner)}},_enablePlugin:function(e){this._enableDisable(e,!1)},_disablePlugin:function(e){this._enableDisable(e,!0)},_enableDisable:function(t,n){var i=e.data(t,this.propertyName);i&&(t.disabled=n,t.nextSibling&&"span"==t.nextSibling.nodeName.toLowerCase()&&s._changeSpinner(i,t.nextSibling,n?5:-1),s._disabledInputs=e.map(s._disabledInputs,function(e){return e==t?null:e}),n&&s._disabledInputs.push(t))},_isDisabledPlugin:function(t){return e.inArray(t,this._disabledInputs)>-1},_destroyPlugin:function(t){t=e(t),t.hasClass(this.markerClassName)&&(t.removeClass(this.markerClassName).removeData(this.propertyName).unbind("."+this.propertyName),e.fn.mousewheel&&t.unmousewheel(),this._disabledInputs=e.map(this._disabledInputs,function(e){return e==t[0]?null:e}),t.siblings("."+this._appendClass+",."+this._controlClass).remove())},_setTimePlugin:function(t,n){var i=e.data(t,this.propertyName);i&&(null===n||""===n?i.input.val(""):this._setTime(i,n?"object"==typeof n?new Date(n.getTime()):n:null))},_getTimePlugin:function(t){var n=e.data(t,this.propertyName),i=n?this._extractTime(n):null;return i?new Date(0,0,0,i[0],i[1],i[2]):null},_getOffsetPlugin:function(t){var n=e.data(t,this.propertyName),i=n?this._extractTime(n):null;return i?1e3*(3600*i[0]+60*i[1]+i[2]):0},_doFocus:function(t){var n=t.nodeName&&"input"==t.nodeName.toLowerCase()?t:this;if(s._lastInput==n||s._isDisabledPlugin(n))return void(s._focussed=!1);var i=e.data(n,s.propertyName);s._focussed=!0,s._lastInput=n,s._blurredInput=null,e.extend(i.options,e.isFunction(i.options.beforeShow)?i.options.beforeShow.apply(n,[n]):{}),s._parseTime(i),setTimeout(function(){s._showField(i)},10)},_doBlur:function(e){s._blurredInput=s._lastInput,s._lastInput=null},_doClick:function(t){var n=t.target,i=e.data(n,s.propertyName),a=i._field;if(!s._focussed){var o=i.options.separator.length+2;if(i._field=0,null!=n.selectionStart)for(var r=0;r<=Math.max(1,i._secondField,i._ampmField);r++){var p=r!=i._ampmField?r*o+2:i._ampmField*o+i.options.ampmPrefix.length+i.options.ampmNames[0].length;if(i._field=r,n.selectionStart<p)break}else if(n.createTextRange)for(var l=e(t.srcElement),u=n.createTextRange(),d=function(e){return{thin:2,medium:4,thick:6}[e]||e},_=t.clientX+document.documentElement.scrollLeft-(l.offset().left+parseInt(d(l.css("border-left-width")),10))-u.offsetLeft,r=0;r<=Math.max(1,i._secondField,i._ampmField);r++){var p=r!=i._ampmField?r*o+2:i._ampmField*o+i.options.ampmPrefix.length+i.options.ampmNames[0].length;if(u.collapse(),u.moveEnd("character",p),i._field=r,_<u.boundingWidth)break}}a!=i._field&&(i._lastChr=""),s._showField(i),s._focussed=!1},_doKeyDown:function(t){if(t.keyCode>=48)return!0;var n=e.data(t.target,s.propertyName);switch(t.keyCode){case 9:return t.shiftKey?s._changeField(n,-1,!0):s._changeField(n,1,!0);case 35:t.ctrlKey?s._setValue(n,""):(n._field=Math.max(1,n._secondField,n._ampmField),s._adjustField(n,0));break;case 36:t.ctrlKey?s._setTime(n):(n._field=0,s._adjustField(n,0));break;case 37:s._changeField(n,-1,!1);break;case 38:s._adjustField(n,1);break;case 39:s._changeField(n,1,!1);break;case 40:s._adjustField(n,-1);break;case 46:s._setValue(n,"");break;default:return!0}return!1},_doKeyPress:function(t){var n=String.fromCharCode(void 0==t.charCode?t.keyCode:t.charCode);if(" ">n)return!0;var i=e.data(t.target,s.propertyName);return s._handleKeyPress(i,n),!1},_doMouseWheel:function(t,n){if(!s._isDisabledPlugin(t.target)){var i=e.data(t.target,s.propertyName);i.input.focus(),i.input.val()||s._parseTime(i),s._adjustField(i,n),t.preventDefault()}},_expandSpinner:function(t){var n=s._getSpinnerTarget(t),i=e.data(s._getInput(n),s.propertyName);if(!s._isDisabledPlugin(i.input[0])&&i.options.spinnerBigImage){i._expanded=!0;var a=e(n).offset(),o=null;e(n).parents().each(function(){var t=e(this);return("relative"==t.css("position")||"absolute"==t.css("position"))&&(o=t.offset()),!o}),e('<div class="'+s._expandClass+'" style="position: absolute; left: '+(a.left-(i.options.spinnerBigSize[0]-i.options.spinnerSize[0])/2-(o?o.left:0))+"px; top: "+(a.top-(i.options.spinnerBigSize[1]-i.options.spinnerSize[1])/2-(o?o.top:0))+"px; width: "+i.options.spinnerBigSize[0]+"px; height: "+i.options.spinnerBigSize[1]+"px; background: transparent url("+i.options.spinnerBigImage+') no-repeat 0px 0px; z-index: 10;"></div>').mousedown(s._handleSpinner).mouseup(s._endSpinner).mouseout(s._endExpand).mousemove(s._describeSpinner).insertAfter(n)}},_getInput:function(t){return e(t).siblings("."+s.markerClassName)[0]},_describeSpinner:function(t){var n=s._getSpinnerTarget(t),i=e.data(s._getInput(n),s.propertyName);n.title=i.options.spinnerTexts[s._getSpinnerRegion(i,t)]},_handleSpinner:function(t){var n=s._getSpinnerTarget(t),i=s._getInput(n);if(!s._isDisabledPlugin(i)){i==s._blurredInput&&(s._lastInput=i,s._blurredInput=null);var a=e.data(i,s.propertyName);s._doFocus(i);var o=s._getSpinnerRegion(a,t);s._changeSpinner(a,n,o),s._actionSpinner(a,o),s._timer=null,s._handlingSpinner=!0,o>=3&&a.options.spinnerRepeat[0]&&(s._timer=setTimeout(function(){s._repeatSpinner(a,o)},a.options.spinnerRepeat[0]),e(n).one("mouseout",s._releaseSpinner).one("mouseup",s._releaseSpinner))}},_actionSpinner:function(e,t){switch(e.input.val()||s._parseTime(e),t){case 0:this._setTime(e);break;case 1:this._changeField(e,-1,!1);break;case 2:this._changeField(e,1,!1);break;case 3:this._adjustField(e,1);break;case 4:this._adjustField(e,-1)}},_repeatSpinner:function(e,t){s._timer&&(s._lastInput=s._blurredInput,this._actionSpinner(e,t),this._timer=setTimeout(function(){s._repeatSpinner(e,t)},e.options.spinnerRepeat[1]))},_releaseSpinner:function(e){clearTimeout(s._timer),s._timer=null},_endExpand:function(t){s._timer=null;var n=s._getSpinnerTarget(t),i=s._getInput(n),a=e.data(i,s.propertyName);e(n).remove(),a._expanded=!1},_endSpinner:function(t){s._timer=null;var n=s._getSpinnerTarget(t),i=s._getInput(n),a=e.data(i,s.propertyName);s._isDisabledPlugin(i)||s._changeSpinner(a,n,-1),s._handlingSpinner&&(s._lastInput=s._blurredInput),s._lastInput&&s._handlingSpinner&&s._showField(a),s._handlingSpinner=!1},_getSpinnerTarget:function(e){return e.target||e.srcElement},_getSpinnerRegion:function(t,n){var i=this._getSpinnerTarget(n),s=e(i).offset(),a=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],o=t.options.spinnerIncDecOnly?99:n.clientX+a[0]-s.left,r=n.clientY+a[1]-s.top,p=t.options[t._expanded?"spinnerBigSize":"spinnerSize"],l=t.options.spinnerIncDecOnly?99:p[0]-1-o,u=p[1]-1-r;if(p[2]>0&&Math.abs(o-l)<=p[2]&&Math.abs(r-u)<=p[2])return 0;var d=Math.min(o,r,l,u);return d==o?1:d==l?2:d==r?3:4},_changeSpinner:function(t,n,i){e(n).css("background-position","-"+(i+1)*t.options[t._expanded?"spinnerBigSize":"spinnerSize"][0]+"px 0px")},_parseTime:function(e){var t=this._extractTime(e);if(t)e._selectedHour=t[0],e._selectedMinute=t[1],e._selectedSecond=t[2];else{var n=this._constrainTime(e);e._selectedHour=n[0],e._selectedMinute=n[1],e._selectedSecond=e.options.showSeconds?n[2]:0}e._secondField=e.options.showSeconds?2:-1,e._ampmField=e.options.show24Hours?-1:e.options.showSeconds?3:2,e._lastChr="",e._field=Math.max(0,Math.min(Math.max(1,e._secondField,e._ampmField),e.options.initialField)),""!=e.input.val()&&this._showTime(e)},_extractTime:function(e,t){t=t||e.input.val();var n=t.split(e.options.separator);if(""==e.options.separator&&""!=t&&(n[0]=t.substring(0,2),n[1]=t.substring(2,4),n[2]=t.substring(4,6)),n.length>=2){var i=!e.options.show24Hours&&t.indexOf(e.options.ampmNames[0])>-1,s=!e.options.show24Hours&&t.indexOf(e.options.ampmNames[1])>-1,a=parseInt(n[0],10);a=isNaN(a)?0:a,a=((i||s)&&12==a?0:a)+(s?12:0);var o=parseInt(n[1],10);o=isNaN(o)?0:o;var r=n.length>=3?parseInt(n[2],10):0;return r=isNaN(r)||!e.options.showSeconds?0:r,this._constrainTime(e,[a,o,r])}return null},_constrainTime:function(e,t){var n=null!=t;if(!n){var i=this._determineTime(e.options.defaultTime,e)||new Date;t=[i.getHours(),i.getMinutes(),i.getSeconds()]}for(var s=!1,a=0;a<e.options.timeSteps.length;a++)s?t[a]=0:e.options.timeSteps[a]>1&&(t[a]=Math.round(t[a]/e.options.timeSteps[a])*e.options.timeSteps[a],s=!0);return t},_showTime:function(e){var t=this._formatNumber(e.options.show24Hours?e._selectedHour:(e._selectedHour+11)%12+1)+e.options.separator+this._formatNumber(e._selectedMinute)+(e.options.showSeconds?e.options.separator+this._formatNumber(e._selectedSecond):"")+(e.options.show24Hours?"":e.options.ampmPrefix+e.options.ampmNames[e._selectedHour<12?0:1]);this._setValue(e,t),this._showField(e)},_showField:function(e){var t=e.input[0];if(!e.input.is(":hidden")&&s._lastInput==t){var n=e.options.separator.length+2,i=e._field!=e._ampmField?e._field*n:e._ampmField*n-e.options.separator.length+e.options.ampmPrefix.length,a=i+(e._field!=e._ampmField?2:e.options.ampmNames[0].length);if(t.setSelectionRange)t.setSelectionRange(i,a);else if(t.createTextRange){var o=t.createTextRange();o.moveStart("character",i),o.moveEnd("character",a-e.input.val().length),o.select()}t.disabled||t.focus()}},_formatNumber:function(e){return(10>e?"0":"")+e},_setValue:function(e,t){t!=e.input.val()&&e.input.val(t).trigger("change")},_changeField:function(e,t,n){var i=""==e.input.val()||e._field==(-1==t?0:Math.max(1,e._secondField,e._ampmField));return i||(e._field+=t),this._showField(e),e._lastChr="",i&&n},_adjustField:function(e,t){""==e.input.val()&&(t=0),this._setTime(e,new Date(0,0,0,e._selectedHour+(0==e._field?t*e.options.timeSteps[0]:0)+(e._field==e._ampmField?12*t:0),e._selectedMinute+(1==e._field?t*e.options.timeSteps[1]:0),e._selectedSecond+(e._field==e._secondField?t*e.options.timeSteps[2]:0)))},_setTime:function(t,n){n=this._determineTime(n,t);var i=this._constrainTime(t,n?[n.getHours(),n.getMinutes(),n.getSeconds()]:null);n=new Date(0,0,0,i[0],i[1],i[2]);var n=this._normaliseTime(n),s=this._normaliseTime(this._determineTime(t.options.minTime,t)),a=this._normaliseTime(this._determineTime(t.options.maxTime,t));s&&a&&s>a?s>n&&n>a&&(n=Math.abs(n-s)<Math.abs(n-a)?s:a):n=s&&s>n?s:a&&n>a?a:n,e.isFunction(t.options.beforeSetTime)&&(n=t.options.beforeSetTime.apply(t.input[0],[this._getTimePlugin(t.input[0]),n,s,a])),t._selectedHour=n.getHours(),t._selectedMinute=n.getMinutes(),t._selectedSecond=n.getSeconds(),this._showTime(t)},_determineTime:function(e,t){var n=function(e){var t=new Date;return t.setTime(t.getTime()+1e3*e),t},i=function(e){var n=s._extractTime(t,e),i=new Date,a=n?n[0]:i.getHours(),o=n?n[1]:i.getMinutes(),r=n?n[2]:i.getSeconds();if(!n)for(var p=/([+-]?[0-9]+)\s*(s|S|m|M|h|H)?/g,l=p.exec(e);l;){switch(l[2]||"s"){case"s":case"S":r+=parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10);break;case"h":case"H":a+=parseInt(l[1],10)}l=p.exec(e)}return i=new Date(0,0,10,a,o,r,0),/^!/.test(e)&&(i.getDate()>10?i=new Date(0,0,10,23,59,59):i.getDate()<10&&(i=new Date(0,0,10,0,0,0))),i};return e?"string"==typeof e?i(e):"number"==typeof e?n(e):e:null},_normaliseTime:function(e){return e?(e.setFullYear(1900),e.setMonth(0),e.setDate(0),e):null},_handleKeyPress:function(e,t){if(t==e.options.separator)this._changeField(e,1,!1);else if(t>="0"&&"9">=t){var n=parseInt(t,10),i=parseInt(e._lastChr+t,10),s=0!=e._field?e._selectedHour:e.options.show24Hours?24>i?i:n:(i>=1&&12>=i?i:n>0?n:e._selectedHour)%12+(e._selectedHour>=12?12:0),a=1!=e._field?e._selectedMinute:60>i?i:n,o=e._field!=e._secondField?e._selectedSecond:60>i?i:n,r=this._constrainTime(e,[s,a,o]);this._setTime(e,new Date(0,0,0,r[0],r[1],r[2])),e.options.noSeparatorEntry&&e._lastChr?this._changeField(e,1,!1):e._lastChr=t}else if(!e.options.show24Hours&&(t=t.toLowerCase(),t==e.options.ampmNames[0].substring(0,1).toLowerCase()&&e._selectedHour>=12||t==e.options.ampmNames[1].substring(0,1).toLowerCase()&&e._selectedHour<12)){var p=e._field;e._field=e._ampmField,this._adjustField(e,1),e._field=p,this._showField(e)}}});var i=["getOffset","getTime","isDisabled"];e.fn.timeEntry=function(t){var i=Array.prototype.slice.call(arguments,1);return n(t,i)?s["_"+t+"Plugin"].apply(s,[this[0]].concat(i)):this.each(function(){if("string"==typeof t){if(!s["_"+t+"Plugin"])throw"Unknown command: "+t;s["_"+t+"Plugin"].apply(s,[this].concat(i))}else{var n=e.fn.metadata?e(this).metadata():{};s._attachPlugin(this,e.extend({},n,t||{}))}})};var s=e.timeEntry=new t}(jQuery);