!function(t){function i(i){this.form=i,this.setState=function(){var i=[];return t(".context-plugin-list > li",this.form).each(function(){var e=t(this).attr("class").split("context-plugin-")[1].split(" ")[0];t(this).is(".disabled")?t(".context-plugin-selector select option[value="+e+"]",this.form).show():(i.push(e),t(".context-plugin-selector select option[value="+e+"]",this.form).hide())}),t(".context-plugin-selector input.context-plugins-state",this.form).val(i.join(",")),t(".context-plugin-selector select",this.form).val(0),this},this.addPlugin=function(i){return t(".context-plugin-list > li.context-plugin-"+i,this.form).removeClass("disabled"),this.showForm(i).setState(),this},this.removePlugin=function(i){return t(".context-plugin-list > li.context-plugin-"+i,this.form).addClass("disabled"),this.hideForm(i).setState(),this},this.showForm=function(i){return t(".context-plugin-forms > .context-plugin-form.active-form",this.form).removeClass("active-form"),t(".context-plugin-forms > .context-plugin-form-"+i,this.form).addClass("active-form"),t(".context-plugin-list > li > a").removeClass("active-form"),t(".context-plugin-list > li.context-plugin-"+i+" > a").addClass("active-form"),this},this.hideForm=function(i){return t(".context-plugin-forms > .context-plugin-form-"+i,this.form).removeClass("active-form"),t(".context-plugin-list > li.context-plugin-"+i+" > a").removeClass("active-form"),this},t(".context-plugin-selector select",this.form).change(function(){var i=t(this).parents("div.context-plugins").data("contextPlugins");if(i){var e=t(this).val();i.addPlugin(e)}}),t(".context-plugin-list > li > a",this.form).click(function(){var i=t(this).parents("div.context-plugins").data("contextPlugins");if(i){var e=t(this).attr("href").split("#context-plugin-form-")[1];i.showForm(e)}return!1}),t(".context-plugin-list span.remove",this.form).click(function(){var i=t(this).parents("div.context-plugins").data("contextPlugins");if(i){var e=t(this).parent().attr("href").split("#context-plugin-form-")[1];i.removePlugin(e)}return!1}),this.setState()}Drupal.behaviors.context_ui={attach:function(e){t("form div.context-plugins:not(.context-ui-processed)").each(function(){t(this).addClass("context-ui-processed"),t(this).data("contextPlugins",new i(t(this)))}),t().pageEditor&&t("form.context-editor:not(.context-ui-processed)").addClass("context-ui-processed").pageEditor().each(function(){var i=t(this),e=t("li.context-editable",this).attr("id").split("context-editable-trigger-")[1];t(this).data("defaultContext",e),t("li.context-editable a.edit",i).click(function(){var e=t(this).parents("li.context-editable").addClass("context-editing"),n=e.attr("id").split("context-editable-trigger-")[1];return i.pageEditor("start",n),!1}),t("li.context-editable a.done",i).click(function(){return i.pageEditor("end"),!1}),t(i).submit(function(){i.pageEditor("isEditing")&&i.pageEditor("end")}),i.bind("start.pageEditor",function(i,e){e||(e=t(this).data("defaultContext"),t("li#context-editable-trigger-"+e,this).addClass("context-editing")),t(document.body).addClass("context-editing"),t("#context-editable-"+e,this).show()}),i.bind("end.pageEditor",function(i,e){t(document.body).removeClass("context-editing"),t("div.contexts div.context-editable",this).hide(),t("li.context-editable").removeClass("context-editing"),t("form.context-editor").addClass("edited")})})}}}(jQuery);