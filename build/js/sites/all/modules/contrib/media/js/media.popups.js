!function(e){namespace("Drupal.media.popups"),Drupal.media.popups.mediaBrowser=function(a,i,o,r){var p=Drupal.media.popups.mediaBrowser.getDefaults();p.global=e.extend({},p.global,i),p.plugins=o,p.widget=e.extend({},p.widget,r);var t=p.widget.src;e.isArray(t)&&t.length&&(t=t[t.length-1]);var l={};e.extend(l,p.global),l.plugins=p.plugins,t+="&"+e.param(l);var d=Drupal.media.popups.getPopupIframe(t,"mediaBrowser");d.bind("load",p,p.widget.onLoad);var s="OK",n="You have not selected anything!";Drupal&&Drupal.t&&(s=Drupal.t(s),n=Drupal.t(n));var u=p.dialog;u.buttons[s]=function(){var i=this.contentWindow.Drupal.media.browser.selectedMedia;return i.length<1?void alert(n):(a(i),void e(this).dialog("close"))};var m=d.dialog(u);return Drupal.media.popups.sizeDialog(m),Drupal.media.popups.resizeDialog(m),Drupal.media.popups.scrollDialog(m),Drupal.media.popups.overlayDisplace(m.parents(".ui-dialog")),d},Drupal.media.popups.mediaBrowser.mediaBrowserOnLoad=function(a){a.data;if(void 0!=this.contentWindow.Drupal.media&&this.contentWindow.Drupal.media.browser.selectedMedia.length>0){var i=Drupal&&Drupal.t?Drupal.t("OK"):"OK",o=e(this).dialog("option","buttons")[i];return void o.call(this)}},Drupal.media.popups.mediaBrowser.getDefaults=function(){return{global:{types:[],activePlugins:[]},widget:{src:Drupal.settings.media.browserUrl,onLoad:Drupal.media.popups.mediaBrowser.mediaBrowserOnLoad},dialog:Drupal.media.popups.getDialogOptions()}},Drupal.media.popups.mediaBrowser.finalizeSelection=function(){var a=this.contentWindow.Drupal.media.browser.selectedMedia;return a.length<1?void alert(notSelected):(onSelect(a),void e(this).dialog("close"))},Drupal.media.popups.mediaStyleSelector=function(a,i,o){var r=Drupal.media.popups.mediaStyleSelector.getDefaults();if("string"==typeof r.src)r.src=r.src.replace("-media_id-",a.fid)+"&fields="+encodeURIComponent(JSON.stringify(a.fields));else{var p=r.src.shift();r.src.unshift(p),r.src=p.replace("-media_id-",a.fid)+"&fields="+encodeURIComponent(JSON.stringify(a.fields))}o=e.extend({},r,o);var t=Drupal.media.popups.getPopupIframe(o.src,"mediaStyleSelector");t.bind("load",o,o.onLoad);var l="OK",d="Very sorry, there was an unknown error embedding media.";Drupal&&Drupal.t&&(l=Drupal.t(l),d=Drupal.t(d));var s=Drupal.media.popups.getDialogOptions();s.buttons[l]=function(){var a=this.contentWindow.Drupal.media.formatForm.getFormattedMedia();return a?(i(a),void e(this).dialog("close")):void alert(d)};var n=t.dialog(s);return Drupal.media.popups.sizeDialog(n),Drupal.media.popups.resizeDialog(n),Drupal.media.popups.scrollDialog(n),Drupal.media.popups.overlayDisplace(n.parents(".ui-dialog")),t},Drupal.media.popups.mediaStyleSelector.mediaBrowserOnLoad=function(e){},Drupal.media.popups.mediaStyleSelector.getDefaults=function(){return{src:Drupal.settings.media.styleSelectorUrl,onLoad:Drupal.media.popups.mediaStyleSelector.mediaBrowserOnLoad}},Drupal.media.popups.mediaFieldEditor=function(a,i,o){var r=Drupal.media.popups.mediaFieldEditor.getDefaults();r.src=r.src.replace("-media_id-",a),o=e.extend({},r,o);var p=Drupal.media.popups.getPopupIframe(o.src,"mediaFieldEditor");p.bind("load",o,o.onLoad);var t="OK",l="Very sorry, there was an unknown error embedding media.";Drupal&&Drupal.t&&(t=Drupal.t(t),l=Drupal.t(l));var d=Drupal.media.popups.getDialogOptions();d.buttons[t]=function(){var a=this.contentWindow.Drupal.media.formatForm.getFormattedMedia();return a?(i(a),void e(this).dialog("close")):void alert(l)};var s=p.dialog(d);return Drupal.media.popups.sizeDialog(s),Drupal.media.popups.resizeDialog(s),Drupal.media.popups.scrollDialog(s),Drupal.media.popups.overlayDisplace(s),p},Drupal.media.popups.mediaFieldEditor.mediaBrowserOnLoad=function(e){},Drupal.media.popups.mediaFieldEditor.getDefaults=function(){return{src:"/media/-media_id-/edit?render=media-popup",onLoad:Drupal.media.popups.mediaFieldEditor.mediaBrowserOnLoad}},Drupal.media.popups.getDialogOptions=function(){return{buttons:{},dialogClass:Drupal.settings.media.dialogOptions.dialogclass,modal:Drupal.settings.media.dialogOptions.modal,draggable:Drupal.settings.media.dialogOptions.draggable,resizable:Drupal.settings.media.dialogOptions.resizable,minWidth:Drupal.settings.media.dialogOptions.minwidth,width:Drupal.settings.media.dialogOptions.width,height:Drupal.settings.media.dialogOptions.height,position:Drupal.settings.media.dialogOptions.position,overlay:{backgroundColor:Drupal.settings.media.dialogOptions.overlay.backgroundcolor,opacity:Drupal.settings.media.dialogOptions.overlay.opacity},zIndex:Drupal.settings.media.dialogOptions.zindex,close:function(a,i){e(a.target).remove()}}},Drupal.media.popups.getPopupIframe=function(a,i,o){var r={width:"100%",scrolling:"auto"},o=e.extend({},r,o);return e('<iframe class="media-modal-frame"/>').attr("src",a).attr("width",o.width).attr("id",i).attr("scrolling",o.scrolling)},Drupal.media.popups.overlayDisplace=function(e){if(parent.window.Drupal.overlay&&jQuery.isFunction(parent.window.Drupal.overlay.getDisplacement)){var a=parent.window.Drupal.overlay.getDisplacement("top");e.offset().top<a&&e.css("top",a)}},Drupal.media.popups.sizeDialog=function(a){if(a.is(":visible")){var i=e(window).width(),o=.8*i,r=e(window).height(),p=.8*r;a.dialog("option","width",o),a.dialog("option","height",p),a.dialog("option","position","center"),e(".media-modal-frame").width("100%")}},Drupal.media.popups.resizeDialog=function(a){e(window).resize(function(){Drupal.media.popups.sizeDialog(a)})},Drupal.media.popups.scrollDialog=function(a){e(window).scroll(function(){a.is(":visible")&&a.dialog("option","position","center")})}}(jQuery);