!function(o){Drupal.CTools=Drupal.CTools||{},Drupal.CTools.Modal=Drupal.CTools.Modal||{},Drupal.CTools.Modal.show=function(t){var e={};t&&"string"==typeof t&&Drupal.settings[t]?o.extend(!0,e,Drupal.settings[t]):t&&o.extend(!0,e,t);var l={modalTheme:"CToolsModalDialog",throbberTheme:"CToolsModalThrobber",animation:"show",animationSpeed:"fast",modalSize:{type:"scale",width:.8,height:.8,addWidth:0,addHeight:0,contentRight:25,contentBottom:45},modalOptions:{opacity:.55,background:"#fff"},modalClass:"default"},a={};o.extend(!0,a,l,Drupal.settings.CToolsModal,e),Drupal.CTools.Modal.currentSettings&&Drupal.CTools.Modal.currentSettings!=a&&(Drupal.CTools.Modal.modal.remove(),Drupal.CTools.Modal.modal=null),Drupal.CTools.Modal.currentSettings=a;var n=function(t){var e=t?document:Drupal.CTools.Modal.modal;if("scale"==Drupal.CTools.Modal.currentSettings.modalSize.type)var l=o(window).width()*Drupal.CTools.Modal.currentSettings.modalSize.width,a=o(window).height()*Drupal.CTools.Modal.currentSettings.modalSize.height;else var l=Drupal.CTools.Modal.currentSettings.modalSize.width,a=Drupal.CTools.Modal.currentSettings.modalSize.height;o("div.ctools-modal-content",e).css({width:l+Drupal.CTools.Modal.currentSettings.modalSize.addWidth+"px",height:a+Drupal.CTools.Modal.currentSettings.modalSize.addHeight+"px"}),o("div.ctools-modal-content .modal-content",e).css({width:l-Drupal.CTools.Modal.currentSettings.modalSize.contentRight+"px",height:a-Drupal.CTools.Modal.currentSettings.modalSize.contentBottom+"px"})};Drupal.CTools.Modal.modal||(Drupal.CTools.Modal.modal=o(Drupal.theme(a.modalTheme)),"scale"==a.modalSize.type&&o(window).bind("resize",n)),n(),o("span.modal-title",Drupal.CTools.Modal.modal).html(Drupal.CTools.Modal.currentSettings.loadingText),Drupal.CTools.Modal.modalContent(Drupal.CTools.Modal.modal,a.modalOptions,a.animation,a.animationSpeed,a.modalClass),o("#modalContent .modal-content").html(Drupal.theme(a.throbberTheme)).addClass("ctools-modal-loading"),o("#modalContent .modal-content").delegate("input.form-autocomplete","keyup",function(){o("#autocomplete").css("top",o(this).position().top+o(this).outerHeight()+o(this).offsetParent().filter("#modal-content").scrollTop())})},Drupal.CTools.Modal.dismiss=function(){Drupal.CTools.Modal.modal&&Drupal.CTools.Modal.unmodalContent(Drupal.CTools.Modal.modal)},Drupal.theme.prototype.CToolsModalDialog=function(){var o="";return o+='  <div id="ctools-modal">',o+='    <div class="ctools-modal-content">',o+='      <div class="modal-header">',o+='        <a class="close" href="#">',o+=Drupal.CTools.Modal.currentSettings.closeText+Drupal.CTools.Modal.currentSettings.closeImage,o+="        </a>",o+='        <span id="modal-title" class="modal-title">&nbsp;</span>',o+="      </div>",o+='      <div id="modal-content" class="modal-content">',o+="      </div>",o+="    </div>",o+="  </div>"},Drupal.theme.prototype.CToolsModalThrobber=function(){var o="";return o+='  <div id="modal-throbber">',o+='    <div class="modal-throbber-wrapper">',o+=Drupal.CTools.Modal.currentSettings.throbber,o+="    </div>",o+="  </div>"},Drupal.CTools.Modal.getSettings=function(t){var e=o(t).attr("class").match(/ctools-modal-(\S+)/);return e?e[1]:void 0},Drupal.CTools.Modal.clickAjaxCacheLink=function(){return Drupal.CTools.Modal.show(Drupal.CTools.Modal.getSettings(this)),Drupal.CTools.AJAX.clickAJAXCacheLink.apply(this)},Drupal.CTools.Modal.clickAjaxLink=function(){return Drupal.CTools.Modal.show(Drupal.CTools.Modal.getSettings(this)),!1},Drupal.CTools.Modal.submitAjaxForm=function(t){var e=o(this),l=e.attr("action");return setTimeout(function(){Drupal.CTools.AJAX.ajaxSubmit(e,l)},1),!1},Drupal.behaviors.ZZCToolsModal={attach:function(t){o("area.ctools-use-modal, a.ctools-use-modal",t).once("ctools-use-modal",function(){var t=o(this);t.click(Drupal.CTools.Modal.clickAjaxLink);var e={};t.attr("href")&&(e.url=t.attr("href"),e.event="click",e.progress={type:"throbber"});var l=t.attr("href");Drupal.ajax[l]=new Drupal.ajax(l,this,e)}),o("input.ctools-use-modal, button.ctools-use-modal",t).once("ctools-use-modal",function(){var t=o(this);t.click(Drupal.CTools.Modal.clickAjaxLink);var e=this,l={};l.url=Drupal.CTools.Modal.findURL(this),""==l.url&&(l.url=o(this).closest("form").attr("action")),l.event="click",l.setClick=!0;var a=t.attr("id");Drupal.ajax[a]=new Drupal.ajax(a,this,l),o("."+o(e).attr("id")+"-url").change(function(){Drupal.ajax[a].options.url=Drupal.CTools.Modal.findURL(e)})}),o("#modal-content form",t).once("ctools-use-modal",function(){var t=o(this),e={};e.url=t.attr("action"),e.event="submit",e.progress={type:"throbber"};var l=t.attr("id");Drupal.ajax[l]=new Drupal.ajax(l,this,e),Drupal.ajax[l].form=t,o("input[type=submit], button",this).click(function(t){return Drupal.ajax[l].element=this,this.form.clk=this,Drupal.autocompleteSubmit&&!Drupal.autocompleteSubmit()?!1:void 0==t.bubbles?(o(this.form).trigger("submit"),!1):void 0})}),o(".ctools-close-modal",t).once("ctools-close-modal").click(function(){return Drupal.CTools.Modal.dismiss(),!1})}},Drupal.CTools.Modal.modal_display=function(t,e,l){0==o("#modalContent").length&&Drupal.CTools.Modal.show(Drupal.CTools.Modal.getSettings(t.element)),o("#modal-title").html(e.title),o("#modal-content").html(e.output).scrollTop(0);var a=e.settings||t.settings||Drupal.settings;Drupal.attachBehaviors("#modalContent",a),o("#modal-content").hasClass("ctools-modal-loading")?o("#modal-content").removeClass("ctools-modal-loading"):o("#modal-content :focusable:first").focus()},Drupal.CTools.Modal.modal_dismiss=function(t){Drupal.CTools.Modal.dismiss(),o("link.ctools-temporary-css").remove()},Drupal.CTools.Modal.modal_loading=function(o){Drupal.CTools.Modal.modal_display({output:Drupal.theme(Drupal.CTools.Modal.currentSettings.throbberTheme),title:Drupal.CTools.Modal.currentSettings.loadingText})},Drupal.CTools.Modal.findURL=function(t){var e="",l="."+o(t).attr("id")+"-url";return o(l).each(function(){var t=o(this);e&&t.val()&&(e+="/"),e+=t.val()}),e},Drupal.CTools.Modal.modalContent=function(t,e,l,a,n){function d(){o(window).unbind("resize",modalContentResize),o("body").unbind("focus",modalEventHandler),o("body").unbind("keypress",modalEventHandler),o("body").unbind("keydown",modalTabTrapHandler),o(".close").unbind("click",modalContentClose),o("body").unbind("keypress",modalEventEscapeCloseHandler),o(document).trigger("CToolsDetachBehaviors",o("#modalContent")),"fadeIn"==l&&(l="fadeOut"),"slideDown"==l&&(l="slideUp"),"show"==l&&(l="hide"),p.hide()[l](a),o("#modalContent").remove(),o("#modalBackdrop").remove(),o(C).focus()}if(l?"fadeIn"!=l&&"slideDown"!=l&&(l="show"):l="show",a||(a="fast"),e=jQuery.extend({position:"absolute",left:"0px",margin:"0px",background:"#000",opacity:".55"},e),e.filter="alpha(opacity="+100*e.opacity+")",t.hide(),o("#modalBackdrop").length&&o("#modalBackdrop").remove(),o("#modalContent").length&&o("#modalContent").remove(),self.pageYOffset)var s=self.pageYOffset;else if(document.documentElement&&document.documentElement.scrollTop)var s=document.documentElement.scrollTop;else if(document.body)var s=document.body.scrollTop;var r=o(document).height()+50,i=o(document).width(),u=o(window).height(),c=o(window).width();u>r&&(r=u),o("body").append('<div id="modalBackdrop" class="backdrop-'+n+'" style="z-index: 1000; display: none;"></div><div id="modalContent" class="modal-'+n+'" style="z-index: 1001; position: absolute;">'+o(t).html()+"</div>");var m=function(){var t=o("#modalContent :tabbable"),e=t.filter('input[type="radio"]');if(e.length>0){var l={};e.each(function(){var o=this.name;"undefined"==typeof l[o]&&(l[o]=0!==e.filter('input[name="'+o+'"]:checked').length)});var a={};t=t.filter(function(){var o=!0;return"radio"==this.type&&(l[this.name]?o=this.checked:(a[this.name]&&(o=!1),a[this.name]=!0)),o})}return t.get()};modalEventHandler=function(t){target=null,t?target=t.target:(t=window.event,target=t.srcElement);for(var e=o(target).parents().get(),l=0;l<e.length;++l){var a=o(e[l]).css("position");if("absolute"==a||"fixed"==a)return!0}return o(target).is("#modalContent, body")||o(target).filter("*:visible").parents("#modalContent").length?!0:(m()[0].focus(),void t.preventDefault())},o("body").bind("focus",modalEventHandler),o("body").bind("keypress",modalEventHandler),modalTabTrapHandler=function(t){if(9!=t.which)return!0;var e=m(),l=e[0],a=e[e.length-1],n=l==a,d=t.target;if(d==l&&t.shiftKey)return n||a.focus(),!1;if(d==a&&!t.shiftKey)return n||l.focus(),!1;if(-1==o.inArray(d,e)){for(var s=o(d).parents().get(),r=0;r<s.length;++r){var i=o(s[r]).css("position");if("absolute"==i||"fixed"==i)return!0}t.shiftKey?a.focus():l.focus()}},o("body").bind("keydown",modalTabTrapHandler);var p=o("#modalContent").css("top","-1000px"),h=s+u/2-p.outerHeight()/2,f=c/2-p.outerWidth()/2;o("#modalBackdrop").css(e).css("top",0).css("height",r+"px").css("width",i+"px").show(),p.css({top:h+"px",left:f+"px"}).hide()[l](a),modalContentClose=function(){return d(),!1},o(".close").bind("click",modalContentClose),modalEventEscapeCloseHandler=function(o){return 27==o.keyCode?(d(),!1):void 0},o(document).bind("keydown",modalEventEscapeCloseHandler);var C=document.activeElement;o(".close").focus(),modalContentResize=function(){if(o("#modalBackdrop").css("height","").css("width",""),self.pageYOffset)var t=self.pageYOffset;else if(document.documentElement&&document.documentElement.scrollTop)var t=document.documentElement.scrollTop;else if(document.body)var t=document.body.scrollTop;var e=o(document).height(),l=o(document).width(),a=o(window).height(),n=o(window).width();a>e&&(e=a);var d=o("#modalContent"),s=t+a/2-d.outerHeight()/2,r=n/2-d.outerWidth()/2;o("#modalBackdrop").css("height",e+"px").css("width",l+"px").show(),d.css("top",s+"px").css("left",r+"px").show()},o(window).bind("resize",modalContentResize)},Drupal.CTools.Modal.unmodalContent=function(t,e,l){if(e)"fadeOut"!=e&&"slideUp"!=e&&(e="show");else var e="show";if(!l)var l="fast";o(window).unbind("resize",modalContentResize),o("body").unbind("focus",modalEventHandler),o("body").unbind("keypress",modalEventHandler),o("body").unbind("keydown",modalTabTrapHandler),o(".close").unbind("click",modalContentClose),o("body").unbind("keypress",modalEventEscapeCloseHandler),o(document).trigger("CToolsDetachBehaviors",o("#modalContent")),t.each(function(){"fade"==e?o("#modalContent").fadeOut(l,function(){o("#modalBackdrop").fadeOut(l,function(){o(this).remove()}),o(this).remove()}):"slide"==e?o("#modalContent").slideUp(l,function(){o("#modalBackdrop").slideUp(l,function(){o(this).remove()}),o(this).remove()}):(o("#modalContent").remove(),o("#modalBackdrop").remove())})},o(function(){Drupal.ajax.prototype.commands.modal_display=Drupal.CTools.Modal.modal_display,Drupal.ajax.prototype.commands.modal_dismiss=Drupal.CTools.Modal.modal_dismiss})}(jQuery);