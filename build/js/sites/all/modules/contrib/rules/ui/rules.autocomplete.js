Drupal.rules=Drupal.rules||{},function(t){Drupal.behaviors.rules_autocomplete={attach:function(e){var o=Drupal.settings.rules_autocomplete;t("input.rules-autocomplete").once(function(){var e=this;new Drupal.rules.autocomplete(e,o[t(e).attr("id")])})}},Drupal.rules.autocomplete=function(e,o){this.id=o.inputId,this.uri=o.source,this.jqObject=t("#"+this.id),this.cache=new Array,this.jqObject.addClass("ui-corner-left"),this.opendByFocus=!1,this.focusOpens=!0,this.groupSelected=!1,this.button=t("<span>&nbsp;</span>"),this.button.attr({tabIndex:-1,title:"Show all items"}),this.button.insertAfter(this.jqObject),this.button.button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}),this.button.removeClass("ui-corner-all"),this.button.addClass("ui-corner-right ui-button-icon rules-autocomplete-button"),this.jqObject.autocomplete(),this.jqObject.autocomplete("option","minLength",0),this.jqObject.autocomplete("widget").addClass("rules-autocomplete");var s=this;this.jqObject.focus(function(){s.focusOpens?(s.toggle(),s.opendByFocus=!0):s.focusOpens=!0}),this.jqObject.click(function(){s.opendByFocus?s.opendByFocus=!1:s.toggle()}),this.jqObject.bind("autocompleteselect",function(t,e){":"==e.item.value.substring(e.item.value.length-1,e.item.value.length)&&(s.groupSelected=!0),s.focusOpens=!1,s.opendByFocus=!1}),this.jqObject.autocomplete("option","source",function(e,o){return e.term in s.cache?void o(s.cache[e.term]):void t.ajax({url:s.uri+"/"+e.term,dataType:"json",success:function(t){s.success(t,e,o)}})});var u="object"==typeof this.jqObject.data("autocomplete")?"autocomplete":"ui-autocomplete";this.jqObject.data(u)._renderItem=function(e,o){return t("<li></li>").data("item.autocomplete",o).append("<a>"+o.label+"</a>").appendTo(e)},this.jqObject.data(u).close=function(t){var e=this.element.val();void 0===e||s.groupSelected===!1?(clearTimeout(this.closing),this.menu.element.is(":visible")&&(this._trigger("close",t),this.menu.element.hide(),"function"==typeof this.menu.deactivate&&this.menu.deactivate())):(s.jqObject.autocomplete("search",s.jqObject.val()),s.groupSelected=!1)},this.button.click(function(){s.toggle()})},Drupal.rules.autocomplete.prototype.success=function(t,e,o){var s=new Array;jQuery.each(t,function(t,e){s.push({label:e,value:t})}),this.cache[e.term]=s,o(s)},Drupal.rules.autocomplete.prototype.open=function(t){this.jqObject.autocomplete("search",void 0===t?this.jqObject.val():t),this.button.addClass("ui-state-focus")},Drupal.rules.autocomplete.prototype.close=function(){this.jqObject.autocomplete("close"),this.button.removeClass("ui-state-focus")},Drupal.rules.autocomplete.prototype.toggle=function(){if(this.jqObject.autocomplete("widget").is(":visible"))this.close(),this.focusOpens=!0;else{for(var t=this.jqObject.val().split(":"),e="",o=0;o<t.length-1;o++)e=e.concat(t[o])+":";this.focusOpens=!1,this.jqObject.focus(),this.open(e)}}}(jQuery);