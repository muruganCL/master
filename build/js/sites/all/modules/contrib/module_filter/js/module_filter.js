!function(e){Drupal.ModuleFilter={},Drupal.ModuleFilter.explode=function(e){var t=e.match(/([a-zA-Z]+\:(\w+|"[^"]+")*)|\w+|"[^"]+"/g);t||(t=new Array);for(var r=t.length;r--;)t[r]=t[r].replace(/"/g,"");return t},Drupal.ModuleFilter.getState=function(t){if(!Drupal.ModuleFilter.state){Drupal.ModuleFilter.state={};var r=e.cookie("DrupalModuleFilter"),i=r?r.split("&"):[];if(i)for(var l in i)if("string"==typeof i[l]&&-1!=i[l].indexOf("=")){var s=i[l].split("=");2===s.length&&(Drupal.ModuleFilter.state[s[0]]=s[1])}}return Drupal.ModuleFilter.state[t]?Drupal.ModuleFilter.state[t]:!1},Drupal.ModuleFilter.setState=function(t,r){var i=Drupal.ModuleFilter.getState(t);if(i!=r){Drupal.ModuleFilter.state[t]=r;var l=[];for(var s in Drupal.ModuleFilter.state)l.push(s+"="+Drupal.ModuleFilter.state[s]);e.cookie("DrupalModuleFilter",l.join("&"),{expires:7,path:"/"})}},Drupal.ModuleFilter.Filter=function(t,r,i){var l=this;this.element=t,this.text=e(this.element).val(),this.settings=Drupal.settings.moduleFilter,this.selector=r,this.options=e.extend({delay:500,striping:!1,childSelector:null,empty:Drupal.t("No results"),rules:new Array},i),void 0==this.options.wrapper&&(this.options.wrapper=e(l.selector).parent()),this.element.after('<div class="module-filter-clear"><a href="#" class="js-hide">'+Drupal.t("clear")+"</a></div>"),this.text&&e(".module-filter-clear a",this.element.parent()).removeClass("js-hide"),e(".module-filter-clear a",this.element.parent()).click(function(){return l.element.val(""),l.text="",delete l.queries,l.applyFilter(),l.element.focus(),e(this).addClass("js-hide"),!1}),this.updateQueries=function(){var e=Drupal.ModuleFilter.explode(l.text);l.queries=new Array;for(var t in e){var r={operator:"text",string:e[t]};if(void 0!=l.operators&&e[t].indexOf(":")>0){var i=e[t].split(":",2),s=i.shift();void 0!=l.operators[s]&&(r.operator=s,r.string=i.shift())}r.string=r.string.toLowerCase(),l.queries.push(r)}l.queries.length<=0&&l.queries.push({operator:"text",string:""})},this.applyFilter=function(){l.results=new Array,l.updateQueries(),void 0==l.index&&l.buildIndex(),l.element.trigger("moduleFilter:start"),e.each(l.index,function(e,t){var r=t.element;for(var i in l.queries){var s=l.queries[i];if("text"==s.operator){if(t.text.indexOf(s.string)<0)continue}else{var o=l.operators[s.operator];if(!o(s.string,l,t))continue}var a=l.processRules(t);if(a!==!1)return!0}r.addClass("js-hide")}),l.element.trigger("moduleFilter:finish",{results:l.results}),l.options.striping&&l.stripe(),l.results.length>0?l.options.wrapper.find(".module-filter-no-results").remove():l.options.wrapper.find(".module-filter-no-results").length||l.options.wrapper.append(e('<p class="module-filter-no-results"/>').text(l.options.empty))},l.element.keyup(function(t){switch(t.which){case 13:l.timeOut&&clearTimeout(l.timeOut),l.applyFilter();break;default:l.text!=e(this).val()&&(l.timeOut&&clearTimeout(l.timeOut),l.text=e(this).val(),l.text?l.element.parent().find(".module-filter-clear a").removeClass("js-hide"):l.element.parent().find(".module-filter-clear a").addClass("js-hide"),l.element.trigger("moduleFilter:keyup"),l.timeOut=setTimeout(l.applyFilter,l.options.delay))}}),l.element.keypress(function(e){13==e.which&&e.preventDefault()})},Drupal.ModuleFilter.Filter.prototype.buildIndex=function(){var t=this,r=new Array;e(this.selector).each(function(i){var l=t.options.childSelector?e(t.options.childSelector,this).text():e(this).text(),s={key:i,element:e(this),text:l.toLowerCase()};for(var o in t.options.buildIndex){var a=t.options.buildIndex[o];s=e.extend(a(t,s),s)}e(this).data("indexKey",i),r.push(s),delete s}),this.index=r},Drupal.ModuleFilter.Filter.prototype.processRules=function(e){var t=this,r=e.element,i=!0;if(t.options.rules.length>0)for(var l in t.options.rules){var s=t.options.rules[l];if(i=s(t,e),i===!1)break}return i!==!1&&(r.removeClass("js-hide"),t.results.push(e)),i},Drupal.ModuleFilter.Filter.prototype.stripe=function(){var t=this,r={even:"odd",odd:"even"},i="odd";e.each(t.index,function(e,t){t.element.hasClass("js-hide")||(t.element.removeClass("odd even").addClass(i),i=r[i])})},e.fn.moduleFilter=function(e,t){var r=this;r.parents(".module-filter-inputs-wrapper").show(),Drupal.settings.moduleFilter.setFocus&&r.focus(),r.data("moduleFilter",new Drupal.ModuleFilter.Filter(this,e,t))}}(jQuery);