!function($){Drupal.ModuleFilter.tabs={},Drupal.ModuleFilter.enabling={},Drupal.ModuleFilter.disabling={},Drupal.ModuleFilter.jQueryIsNewer=function(){if(void 0==Drupal.ModuleFilter.jQueryNewer){for(var e=$.fn.jquery.split("."),t=new Array("1","4","4"),l=0;l<e.length;++l){if(t.length==l)return Drupal.ModuleFilter.jQueryNewer=!0,Drupal.ModuleFilter.jQueryNewer;if(e[l]!=t[l])return e[l]>t[l]?(Drupal.ModuleFilter.jQueryNewer=!0,Drupal.ModuleFilter.jQueryNewer):(Drupal.ModuleFilter.jQueryNewer=!1,Drupal.ModuleFilter.jQueryNewer)}if(e.length!=t.length)return Drupal.ModuleFilter.jQueryNewer=!1,Drupal.ModuleFilter.jQueryNewer;Drupal.ModuleFilter.jQueryNewer=!1}return Drupal.ModuleFilter.jQueryNewer},Drupal.behaviors.moduleFilterTabs={attach:function(e){Drupal.settings.moduleFilter.tabs&&$("#module-filter-wrapper table:not(.sticky-header)",e).once("module-filter-tabs",function(){function e(t,l){var a=t.offsetParent();return t[0]!=a[0]?(l+=a.position().top,e(a,l)):l}function t(){return null===F&&(F=e(v.parent(),0)),F}function l(){var e=$(window).scrollTop();return e}function a(){var e=$(window).scrollTop(),t=e+$(window).height();return t-=$("#page-actions").height()}function i(e){v.hasClass("bottom-fixed")&&(v.css({position:"absolute",top:v.position().top-t(),bottom:"auto"}),v.removeClass("bottom-fixed")),("absolute"==v.css("position")&&v.offset().top-e>=0||"absolute"!=v.css("position")&&v.offset().top-e<=0)&&(v.addClass("top-fixed"),v.attr("style",""))}function r(e){if(v.hasClass("top-fixed")&&(v.css({position:"absolute",top:v.position().top-t(),bottom:"auto"}),v.removeClass("top-fixed")),v.offset().top+v.height()-e<=0){v.addClass("bottom-fixed");var l="",a=$("#page-actions").height();a>0?l="bottom: "+a+"px":Drupal.settings.moduleFilter.dynamicPosition,v.attr("style",l)}}var s=$("#module-filter-modules"),u=$('input[name="module_filter[name]"]').data("moduleFilter"),o=$(this);$("thead",o).show(),$("tr.admin-package-header",o).remove();var n=$('<div id="module-filter-tabs"></div>'),d="<ul>";for(var p in Drupal.settings.moduleFilter.packageIDs){var b=Drupal.settings.moduleFilter.packageIDs[p],c=b,h="project-tab",m=null,f=Drupal.settings.moduleFilter.countEnabled?'<span class="count">'+Drupal.ModuleFilter.countSummary(b)+"</span>":"";switch(b){case"all":c=Drupal.t("All");break;case"new":c=Drupal.t("New"),m=Drupal.t("Modules installed within the last week."),0==Drupal.settings.moduleFilter.enabledCounts["new"].total&&(h+=" disabled",f+="<span>"+Drupal.t("No modules added within the last week.")+"</span>");break;case"recent":c=Drupal.t("Recent"),m=Drupal.t("Modules enabled/disabled within the last week."),0==Drupal.settings.moduleFilter.enabledCounts.recent.total&&(h+=" disabled",f+="<span>"+Drupal.t("No modules were enabled or disabled within the last week.")+"</span>");break;default:var D=$("#"+b+"-package");c=$.trim(D.text()),D.remove()}d+='<li id="'+b+'-tab" class="'+h+'"><a href="#'+b+'" class="overlay-exclude"'+(m?' title="'+m+'"':"")+"><strong>"+c+'</strong><span class="summary">'+f+"</span></a></li>"}d+="</ul>",n.append(d),s.before(n),$("#module-filter-tabs li").each(function(){var e=$(this),t=e.attr("id");Drupal.ModuleFilter.tabs[t]=new Drupal.ModuleFilter.Tab(e,t)}),$("tbody td.checkbox input",s).change(function(){var e=$(this),t=e.parents("tr").data("indexKey");if(u.index[t].status=e.is(":checked"),Drupal.settings.moduleFilter.visualAid){var l=e.is(":checked")?"enable":"disable";Drupal.ModuleFilter.updateVisualAid(l,e.parents("tr"))}});var g=$("tbody tr.module",o).get();g.sort(function(e,t){var l=$("td:nth(1)",e).text().toLowerCase(),a=$("td:nth(1)",t).text().toLowerCase();return a>l?-1:l>a?1:0}),$.each(g,function(e,t){o.append(t)}),$("tr.module",o).removeClass("odd even").filter(":odd").addClass("even").end().filter(":even").addClass("odd"),u.adjustHeight(),u.element.bind("moduleFilter:start",function(){u.tabResults={"all-tab":{items:{},count:0},"recent-tab":{items:{},count:0},"new-tab":{items:{},count:0}};for(var e in Drupal.ModuleFilter.tabs)void 0!=Drupal.ModuleFilter.tabs[e].resultInfo&&Drupal.ModuleFilter.tabs[e].resultInfo.empty()}),u.element.bind("moduleFilter:finish",function(e,t){if($.each(u.index,function(e,t){if(!t.element.hasClass("js-hide")){var l=Drupal.ModuleFilter.getTabID(t.element);void 0==u.tabResults[l]&&(u.tabResults[l]={items:{},count:0}),void 0==u.tabResults[l].items[t.key]&&(u.tabResults["all-tab"].count++,t.element.hasClass("recent-module")&&u.tabResults["recent-tab"].count++,t.element.hasClass("new-module")&&u.tabResults["new-tab"].count++,u.tabResults[l].items[t.key]=t,u.tabResults[l].count++),void 0!=Drupal.ModuleFilter.activeTab&&"all-tab"!=Drupal.ModuleFilter.activeTab.id&&("recent-tab"==Drupal.ModuleFilter.activeTab.id&&!t.element.hasClass("recent-module")||"new-tab"==Drupal.ModuleFilter.activeTab.id&&!t.element.hasClass("new-module")||"recent-tab"!=Drupal.ModuleFilter.activeTab.id&&"new-tab"!=Drupal.ModuleFilter.activeTab.id&&l!=Drupal.ModuleFilter.activeTab.id)&&t.element.addClass("js-hide")}}),Drupal.settings.moduleFilter.visualAid)if(u.text){for(var l in u.tabResults){var a=Drupal.ModuleFilter.tabs[l];if(void 0==a.resultInfo){var i='<span class="result-info"></span>';$("a",a.element).prepend(i),a.resultInfo=$("span.result-info",a.element)}a.resultInfo.append(u.tabResults[l].count)}if(Drupal.settings.moduleFilter.hideEmptyTabs)for(var l in Drupal.ModuleFilter.tabs)void 0!=u.tabResults[l]?Drupal.ModuleFilter.tabs[l].element.show():(void 0==Drupal.ModuleFilter.activeTab||Drupal.ModuleFilter.activeTab.id!=l)&&Drupal.ModuleFilter.tabs[l].element.hide()}else Drupal.settings.moduleFilter.hideEmptyTabs&&$("#module-filter-tabs li").show();void 0!=Drupal.ModuleFilter.activeTab&&(void 0==u.tabResults[Drupal.ModuleFilter.activeTab.id]||u.tabResults[Drupal.ModuleFilter.activeTab.id].count<=0)&&(u.results=0),u.adjustHeight()}),Drupal.settings.moduleFilter.useURLFragment?$(window).bind("hashchange.module-filter",$.proxy(Drupal.ModuleFilter,"eventHandlerOperateByURLFragment")).triggerHandler("hashchange.module-filter"):Drupal.ModuleFilter.selectTab(),Drupal.settings.moduleFilter.useSwitch&&($("td.checkbox div.form-item").hide(),$("td.checkbox").each(function(e){var t=$(this),l=$(":checkbox",t),a=$(".toggle-enable",t);a.removeClass("js-hide").click(function(){$(this).hasClass("disabled")||(Drupal.ModuleFilter.jQueryIsNewer()?l.click():l.click().change())}),l.click(function(){a.hasClass("disabled")||a.toggleClass("off")})}));var v=$("#module-filter-tabs"),F=null,M=0;$(window).scroll(function(){var e=l(),t=a();s.offset().top>=e?v.removeClass("top-fixed").attr("style",""):e>M&&v.height()>t-e?r(t):i(e),M=e}),u.adjustHeight()})}},Drupal.ModuleFilter.Tab=function(e,t){var l=this;this.id=t,this.hash=t.substring(0,t.length-4),this.element=e,$("a",this.element).click(function(){if(!Drupal.settings.moduleFilter.useURLFragment){var e=l.element.hasClass("selected")?"all":l.hash;return Drupal.ModuleFilter.selectTab(e),!1}return l.element.hasClass("selected")?(window.location.hash="all",!1):void 0}),$("tr."+this.id,$("#system-modules")).hover(function(){l.element.addClass("suggest")},function(){l.element.removeClass("suggest")})},Drupal.ModuleFilter.selectTab=function(hash){if(!hash||void 0==Drupal.ModuleFilter.tabs[hash+"-tab"]||0==Drupal.settings.moduleFilter.enabledCounts[hash].total){if(Drupal.settings.moduleFilter.rememberActiveTab){var activeTab=Drupal.ModuleFilter.getState("activeTab");activeTab&&void 0!=Drupal.ModuleFilter.tabs[activeTab+"-tab"]&&(hash=activeTab)}hash||(hash="all")}void 0!=Drupal.ModuleFilter.activeTab&&Drupal.ModuleFilter.activeTab.element.removeClass("selected"),Drupal.ModuleFilter.activeTab=Drupal.ModuleFilter.tabs[hash+"-tab"],Drupal.ModuleFilter.activeTab.element.addClass("selected");var moduleFilter=$('input[name="module_filter[name]"]').data("moduleFilter"),filter=moduleFilter.applyFilter();if(Drupal.ModuleFilter.modulesTop){var headerOffset=Drupal.settings.tableHeaderOffset?eval(Drupal.settings.tableHeaderOffset+"()"):0;$("html, body").animate({scrollTop:Drupal.ModuleFilter.modulesTop-headerOffset},500)}else Drupal.ModuleFilter.modulesTop=$("#module-filter-modules").offset().top;Drupal.ModuleFilter.setState("activeTab",hash)},Drupal.ModuleFilter.eventHandlerOperateByURLFragment=function(e){var t=$.param.fragment();Drupal.ModuleFilter.selectTab(t)},Drupal.ModuleFilter.countSummary=function(e){return Drupal.t("@enabled of @total",{"@enabled":Drupal.settings.moduleFilter.enabledCounts[e].enabled,"@total":Drupal.settings.moduleFilter.enabledCounts[e].total})},Drupal.ModuleFilter.Tab.prototype.updateEnabling=function(e,t){this.enabling=this.enabling||{},t?delete this.enabling[e]:this.enabling[e]=e},Drupal.ModuleFilter.Tab.prototype.updateDisabling=function(e,t){this.disabling=this.disabling||{},t?delete this.disabling[e]:this.disabling[e]=e},Drupal.ModuleFilter.Tab.prototype.updateVisualAid=function(){var e="",t=new Array,l=new Array;if(void 0!=this.enabling){for(var a in this.enabling)t.push(this.enabling[a]);t.length>0&&(t.sort(),e+='<span class="enabling">+'+t.join('</span>, <span class="enabling">')+"</span>")}if(void 0!=this.disabling){for(var a in this.disabling)l.push(this.disabling[a]);l.length>0&&(l.sort(),t.length>0&&(e+="<br />"),e+='<span class="disabling">-'+l.join('</span>, <span class="disabling">')+"</span>")}void 0==this.visualAid&&($("a span.summary",this.element).append('<span class="visual-aid"></span>'),this.visualAid=$("span.visual-aid",this.element)),this.visualAid.empty().append(e)},Drupal.ModuleFilter.getTabID=function(e){var t=e.data("moduleFilterTabID");if(!t){var l=e.attr("class").split(" ");for(var a in l)if(void 0!=Drupal.ModuleFilter.tabs[l[a]]){t=l[a];break}e.data("moduleFilterTabID",t)}return t},Drupal.ModuleFilter.updateVisualAid=function(e,t){var l=Drupal.ModuleFilter.getTabID(t);if(!l)return!1;var a=Drupal.ModuleFilter.tabs[l],i=$("td:nth(1) strong",t).text();switch(e){case"enable":void 0!=Drupal.ModuleFilter.disabling[l+i]?(delete Drupal.ModuleFilter.disabling[l+i],a.updateDisabling(i,!0),t.removeClass("disabling")):(Drupal.ModuleFilter.enabling[l+i]=i,a.updateEnabling(i),t.addClass("enabling"));break;case"disable":void 0!=Drupal.ModuleFilter.enabling[l+i]?(delete Drupal.ModuleFilter.enabling[l+i],a.updateEnabling(i,!0),t.removeClass("enabling")):(Drupal.ModuleFilter.disabling[l+i]=i,a.updateDisabling(i),t.addClass("disabling"))}a.updateVisualAid()},Drupal.ModuleFilter.Filter.prototype.adjustHeight=function(){var e=$("#module-filter-tabs ul").height()+10;e+=$("#module-filter-tabs #module-filter-submit").height(),$("#module-filter-modules").css("min-height",e),this.element.trigger("moduleFilter:adjustHeight")}}(jQuery);